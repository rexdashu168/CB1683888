<!DOCTYPE html>

<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rexå¤§å” æ™ºèƒ½CBæˆ°æƒ…å®¤</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }

```
    body { 
        font-family: -apple-system, BlinkMacSystemFont, 'Microsoft JhengHei', 'Helvetica Neue', sans-serif; 
        background: #f5f7fa;
        min-height: 100vh;
        overflow-x: hidden;
        color: #333;
    }
    
    /* é ‚éƒ¨å°èˆª - ä¿æŒåŸå§‹é¢¨æ ¼ */
    .header {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color: white;
        padding: 0 15px;
        height: 55px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
    }
    
    .header-left {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .menu-btn {
        background: none;
        border: none;
        color: white;
        font-size: 20px;
        padding: 8px;
        cursor: pointer;
    }
    
    .header-title {
        font-size: 17px;
        font-weight: 600;
    }
    
    .header-badge {
        background: rgba(255,255,255,0.25);
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 12px;
    }
    
    /* å´é‚Šé¸å–® - ç°¡æ½”é¢¨æ ¼ */
    .sidebar {
        position: fixed;
        left: -300px;
        top: 0;
        width: 300px;
        height: 100vh;
        background: white;
        transition: left 0.3s ease;
        z-index: 2000;
        overflow-y: auto;
        box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    }
    
    .sidebar.active {
        left: 0;
    }
    
    .sidebar-header {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        padding: 25px 20px;
        color: white;
    }
    
    .sidebar-logo {
        font-size: 32px;
        margin-bottom: 10px;
    }
    
    .sidebar-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 5px;
    }
    
    .sidebar-subtitle {
        font-size: 12px;
        opacity: 0.8;
    }
    
    .menu-group {
        padding: 15px 0;
    }
    
    .menu-group-title {
        padding: 8px 20px;
        font-size: 12px;
        color: #999;
        font-weight: 600;
        letter-spacing: 0.5px;
    }
    
    .menu-item {
        display: flex;
        align-items: center;
        padding: 14px 20px;
        cursor: pointer;
        transition: all 0.2s;
        color: #333;
        text-decoration: none;
        gap: 15px;
    }
    
    .menu-item:hover {
        background: #f8f9fa;
    }
    
    .menu-item.active {
        background: #e8f0fe;
        color: #1a73e8;
        border-left: 3px solid #1a73e8;
        padding-left: 17px;
    }
    
    .menu-icon {
        font-size: 20px;
        width: 24px;
        text-align: center;
    }
    
    .menu-text {
        font-size: 15px;
        font-weight: 500;
    }
    
    /* é®ç½©å±¤ */
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        display: none;
        z-index: 1500;
    }
    
    .overlay.active {
        display: block;
    }
    
    /* ä¸»å…§å®¹å€ */
    .main-content {
        padding-top: 55px;
        min-height: 100vh;
    }
    
    /* æœå°‹å€ - ä¿æŒåŸå§‹é¢¨æ ¼ */
    .search-container {
        background: white;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    
    .search-title {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
        color: #333;
    }
    
    .search-subtitle {
        font-size: 14px;
        color: #666;
        margin-bottom: 12px;
    }
    
    .search-input {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 16px;
        transition: all 0.2s;
        margin-bottom: 15px;
    }
    
    .search-input:focus {
        outline: none;
        border-color: #1a73e8;
        box-shadow: 0 0 0 3px rgba(26,115,232,0.1);
    }
    
    .search-btn {
        width: 100%;
        padding: 14px;
        background: #1a73e8;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        font-size: 16px;
        cursor: pointer;
    }
    
    .search-hint {
        font-size: 13px;
        color: #999;
        margin-top: 12px;
    }
    
    /* CBè³‡è¨Šå¡ç‰‡ - åŸå§‹é¢¨æ ¼ */
    .cb-info-card {
        background: white;
        margin: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        overflow: hidden;
    }
    
    .cb-header {
        padding: 20px;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .cb-title-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
    }
    
    .cb-name-info {
        flex: 1;
    }
    
    .cb-name {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 4px;
    }
    
    .cb-code {
        font-size: 24px;
        font-weight: 700;
        color: #1a73e8;
    }
    
    .cb-price-info {
        text-align: right;
    }
    
    .cb-price {
        font-size: 32px;
        font-weight: 700;
        color: #ea4335;
    }
    
    .cb-change {
        font-size: 14px;
        color: #666;
        margin-top: 4px;
    }
    
    /* è³‡è¨Šåˆ—è¡¨ */
    .info-list {
        padding: 0;
    }
    
    .info-item {
        display: flex;
        justify-content: space-between;
        padding: 16px 20px;
        border-bottom: 1px solid #f5f5f5;
        transition: background 0.2s;
    }
    
    .info-item:active {
        background: #f8f9fa;
    }
    
    .info-label {
        color: #666;
        font-size: 15px;
    }
    
    .info-value {
        color: #333;
        font-weight: 600;
        font-size: 15px;
    }
    
    .info-value.red { color: #ea4335; }
    .info-value.green { color: #34a853; }
    
    /* åº•éƒ¨æŒ‰éˆ•çµ„ */
    .bottom-actions {
        display: flex;
        gap: 10px;
        padding: 15px 20px;
        background: #f8f9fa;
    }
    
    .action-btn {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
        display: block;
    }
    
    .action-btn.primary, label.action-btn.primary {
        background: #1a73e8;
        color: white;
    }
    
    .action-btn.secondary {
        background: white;
        color: #666;
        border: 1px solid #e0e0e0;
    }
    
    /* åœ–è¡¨å€åŸŸ */
    .chart-section {
        background: white;
        margin: 20px;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .chart-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .time-selector {
        display: flex;
        gap: 8px;
    }
    
    .time-btn {
        padding: 6px 12px;
        border: 1px solid #e0e0e0;
        background: white;
        border-radius: 6px;
        font-size: 13px;
        color: #666;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .time-btn.active {
        background: #1a73e8;
        color: white;
        border-color: #1a73e8;
    }
    
    .chart-container {
        height: 300px;
        position: relative;
    }
    
    /* å¿«é€Ÿé€£çµ */
    .quick-links {
        padding: 20px;
    }
    
    .quick-links-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .links-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }
    
    .link-card {
        background: white;
        padding: 16px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .link-card:active {
        transform: scale(0.98);
    }
    
    .link-icon {
        font-size: 28px;
        margin-bottom: 8px;
    }
    
    .link-text {
        font-size: 14px;
        color: #333;
        font-weight: 500;
    }
    
    /* åˆ—è¡¨æ¨£å¼ */
    .list-section {
        background: white;
        margin: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        overflow: hidden;
    }
    
    .list-header {
        padding: 16px 20px;
        background: #f8f9fa;
        font-weight: 600;
        color: #333;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .list-item {
        display: flex;
        justify-content: space-between;
        padding: 16px 20px;
        border-bottom: 1px solid #f5f5f5;
        transition: background 0.2s;
        cursor: pointer;
    }
    
    .list-item:active {
        background: #f8f9fa;
    }
    
    .list-item-left {
        flex: 1;
    }
    
    .list-item-name {
        font-size: 15px;
        font-weight: 500;
        color: #333;
        margin-bottom: 4px;
    }
    
    .list-item-code {
        font-size: 13px;
        color: #666;
    }
    
    .list-item-right {
        text-align: right;
    }
    
    .list-item-price {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 4px;
    }
    
    .list-item-change {
        font-size: 13px;
    }
    
    .list-item-change.up { color: #ea4335; }
    .list-item-change.down { color: #34a853; }
    
    /* è¼‰å…¥ç•«é¢ */
    .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 3000;
    }
    
    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid #f0f0f0;
        border-top: 3px solid #1a73e8;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .loading-text {
        color: #666;
        font-size: 15px;
    }
    
    /* æª”æ¡ˆä¸Šå‚³å€ */
    .file-upload {
        position: relative;
    }
    
    .file-input {
        display: none;
    }
    
    .file-status {
        font-size: 12px;
        margin-top: 8px;
    }
    
    .status-ok { color: #34a853; }
    .status-error { color: #ea4335; }
    .status-loading { color: #1a73e8; }
    
    /* æ–‡ä»¶ä¸Šå‚³å€ */
    .file-upload-section {
        margin-top: 20px;
        text-align: center;
    }
    
    /* çµæœå¡ç‰‡ */
    .result-card {
        background: white;
        margin: 20px;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .result-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e0e0e0;
    }
    
    .result-header h3 {
        font-size: 20px;
        font-weight: 600;
        margin: 0;
    }
    
    .result-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }
    
    .result-item {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
    }
    
    .result-label {
        font-size: 13px;
        color: #666;
        margin-bottom: 8px;
    }
    
    .result-value {
        font-size: 24px;
        font-weight: 700;
        color: #333;
    }
    
    .result-value.high {
        color: #ea4335;
    }
    
    .result-value.low {
        color: #34a853;
    }
    
    .result-value.amplitude {
        color: #1a73e8;
    }
    
    /* å…¬å¸æŸ¥è©¢çµæœ */
    .company-result {
        background: white;
        margin: 20px;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .company-result h3 {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 10px;
    }
    
    .company-result p {
        color: #666;
        margin-bottom: 20px;
    }
    
    /* ç¯©é¸å™¨ */
    .filter-select {
        padding: 8px 16px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        margin-right: 10px;
        font-size: 14px;
    }
    
    /* ç‹€æ…‹æ¨™ç±¤ */
    .status-tabs {
        display: flex;
        gap: 10px;
        padding: 15px 20px;
        background: white;
        overflow-x: auto;
    }
    
    .status-tab {
        padding: 8px 16px;
        border: 1px solid #e0e0e0;
        background: white;
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        white-space: nowrap;
    }
    
    .status-tab.active {
        background: #1a73e8;
        color: white;
        border-color: #1a73e8;
    }
    
    /* æ‰¹æ¬¡è¼¸å…¥ */
    .batch-input-section {
        background: white;
        padding: 20px;
        margin: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .batch-input-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-bottom: 15px;
    }
    
    .batch-input {
        padding: 10px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        font-size: 14px;
    }
    
    .add-input-btn {
        background: #f0f0f0;
        border: 1px dashed #999;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        margin-right: 10px;
    }
    
    /* æ¢ä»¶ç¯©é¸ */
    .condition-filters {
        background: white;
        padding: 20px;
        margin: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .filter-group {
        margin-bottom: 20px;
    }
    
    .filter-group h3 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 12px;
    }
    
    .filter-group label {
        display: block;
        margin-bottom: 8px;
        font-size: 14px;
    }
    
    .filter-group select {
        width: 100%;
        padding: 8px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        margin-bottom: 10px;
    }
    
    /* åˆ†æçµæœ */
    .analysis-result, .performance-summary {
        background: white;
        margin: 20px;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    /* ç¸¾æ•ˆè³‡è¨Šå€ */
    .performance-info {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
    }
    
    .performance-info h4 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
        color: #333;
    }
    
    /* ç¯©é¸é¢æ¿ */
    .filter-panel {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        display: flex;
        gap: 10px;
    }
    
    .filter-panel select {
        flex: 1;
        padding: 8px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
    }
    
    .filter-btn {
        background: #f0f0f0;
        border: 1px solid #e0e0e0;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 13px;
        cursor: pointer;
    }
    
    /* æ’è¡Œæ¦œåˆ—è¡¨ */
    .ranking-list {
        max-height: 600px;
        overflow-y: auto;
    }
    
    .ranking-item {
        display: flex;
        padding: 12px;
        border-bottom: 1px solid #f0f0f0;
        align-items: center;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .ranking-item:hover {
        background: #f8f9fa;
    }
    
    .ranking-number {
        width: 30px;
        font-weight: 600;
        color: #666;
    }
    
    .ranking-info {
        flex: 1;
        margin-left: 10px;
    }
    
    .ranking-name {
        font-weight: 600;
        color: #333;
    }
    
    .ranking-code {
        font-size: 12px;
        color: #666;
    }
    
    .ranking-value {
        text-align: right;
        font-weight: 700;
        font-size: 18px;
        color: #1a73e8;
    }
    
    /* ç ”ç©¶å ±å‘Šå°ˆå€æ¨£å¼ */
    .industry-tags {
        padding: 15px 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .tag-item {
        padding: 8px 16px;
        background: #f0f0f0;
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .tag-item:hover {
        background: #1a73e8;
        color: white;
    }
    
    .result-container {
        padding: 0 20px;
    }
    
    .info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin: 20px 0;
    }
    
    .info-item {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    
    .info-label {
        font-size: 13px;
        color: #666;
    }
    
    .info-value {
        font-size: 16px;
        font-weight: 600;
        color: #333;
    }
    
    .industry-position {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        font-size: 14px;
        line-height: 1.6;
    }
    
    .concept-list {
        margin-top: 20px;
    }
    
    .concept-list h4 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
    }
    
    .news-list {
        padding: 0 20px;
    }
    
    .news-item {
        background: white;
        padding: 15px;
        margin-bottom: 12px;
        border-radius: 8px;
        border-left: 4px solid #1a73e8;
    }
    
    .news-date {
        font-size: 12px;
        color: #666;
        margin-bottom: 8px;
    }
    
    .news-title {
        font-size: 15px;
        font-weight: 600;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .news-badge {
        padding: 2px 8px;
        background: #ea4335;
        color: white;
        border-radius: 12px;
        font-size: 11px;
    }
    
    .news-content {
        font-size: 14px;
        line-height: 1.5;
        color: #555;
    }
    
    .reports-list {
        padding: 0 20px;
    }
    
    .report-item {
        background: white;
        padding: 20px;
        margin-bottom: 15px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .report-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 15px;
    }
    
    .report-title {
        font-size: 16px;
        font-weight: 600;
    }
    
    .report-rating {
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 13px;
        font-weight: 600;
    }
    
    .rating-buy {
        background: #e6f4ea;
        color: #34a853;
    }
    
    .rating-neutral {
        background: #fef7e0;
        color: #fbbc04;
    }
    
    .rating-sell {
        background: #fce8e6;
        color: #ea4335;
    }
    
    .report-meta {
        display: flex;
        gap: 15px;
        font-size: 13px;
        color: #666;
        margin-bottom: 15px;
    }
    
    .report-summary {
        font-size: 14px;
        line-height: 1.6;
        color: #333;
    }
    
    .coming-soon {
        text-align: center;
        padding: 80px 20px;
    }
    
    .coming-icon {
        font-size: 80px;
        margin-bottom: 20px;
    }
    
    .coming-soon h3 {
        font-size: 20px;
        margin-bottom: 10px;
    }
    
    .coming-soon p {
        color: #666;
    }
    
    /* é é¢å…§å®¹æ¨£å¼ */
    .page-content {
        min-height: calc(100vh - 55px);
        background: #f5f7fa;
    }
    
    .page-header {
        background: white;
        padding: 20px;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .page-title {
        font-size: 20px;
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
    }
    
    .page-subtitle {
        font-size: 14px;
        color: #666;
    }
    
    /* æ’è¡Œæ¦œæ¨£å¼ */
    .ranking-tabs {
        display: flex;
        gap: 10px;
        padding: 15px 20px;
        background: white;
        overflow-x: auto;
    }
    
    .ranking-tab {
        padding: 8px 16px;
        border: 1px solid #e0e0e0;
        background: white;
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        white-space: nowrap;
    }
    
    .ranking-tab.active {
        background: #1a73e8;
        color: white;
        border-color: #1a73e8;
    }
    
    /* CBASçµ±è¨ˆå¡ç‰‡ */
    .cbas-summary {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        padding: 20px;
    }
    
    .summary-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .summary-label {
        font-size: 13px;
        color: #666;
        margin-bottom: 8px;
    }
    
    .summary-value {
        font-size: 24px;
        font-weight: 700;
        color: #1a73e8;
    }
    
    /* åˆ†ææ§åˆ¶é … */
    .analysis-controls {
        padding: 20px;
        background: white;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }
    
    .analysis-select {
        flex: 1;
        padding: 10px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
    }
    
    .indicator-buttons {
        display: flex;
        gap: 8px;
    }
    
    .indicator-btn {
        padding: 8px 16px;
        border: 1px solid #e0e0e0;
        background: white;
        border-radius: 6px;
        font-size: 13px;
        cursor: pointer;
    }
    
    .indicator-btn.active {
        background: #1a73e8;
        color: white;
        border-color: #1a73e8;
    }
    
    /* æ¯”è¼ƒå·¥å…· */
    .comparison-controls {
        padding: 20px;
        background: white;
    }
    
    .add-cb-btn {
        background: #1a73e8;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
    }
    
    .selected-cbs {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        flex-wrap: wrap;
    }
    
    /* ç¯©é¸å™¨ */
    .filter-section {
        background: white;
        padding: 20px;
        margin-bottom: 15px;
    }
    
    .filter-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
    }
    
    .filter-row {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }
    
    .filter-row label {
        min-width: 80px;
        font-size: 14px;
    }
    
    .filter-row input[type="number"] {
        width: 80px;
        padding: 6px;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
    }
    
    .filter-btn {
        background: #1a73e8;
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        display: block;
        margin: 20px auto;
    }
    
    /* æé†’è¨­å®š */
    .add-alert-btn, .add-position-btn {
        background: #1a73e8;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        margin: 20px;
        display: block;
    }
    
    /* åŒ¯å‡ºé¸é … */
    .export-options, .export-format {
        background: white;
        padding: 20px;
        margin-bottom: 15px;
    }
    
    .export-options h3, .export-format h3 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
    }
    
    .export-options label, .export-format label {
        display: block;
        margin-bottom: 10px;
        font-size: 14px;
    }
    
    .export-btn {
        background: #34a853;
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        display: block;
        margin: 20px auto;
    }
</style>
```

</head>
<body>
    <!-- è¼‰å…¥ç•«é¢ -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">æ­£åœ¨åˆå§‹åŒ–ç³»çµ±...</div>
    </div>

```
<!-- é ‚éƒ¨å°èˆª -->
<header class="header">
    <div class="header-left">
        <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
        <div class="header-title">Rexå¤§å” æ™ºèƒ½CBæˆ°æƒ…å®¤</div>
    </div>
    <div class="header-badge" id="dataBadge">è³‡æ–™åº«å°±ç·’ (å…± 1969 æª”)</div>
</header>

<!-- å´é‚Šé¸å–® -->
<div id="sidebar" class="sidebar">
    <div class="sidebar-header">
        <div class="sidebar-logo">ğŸ“ˆ</div>
        <div class="sidebar-title">Rexå¤§å”168</div>
        <div class="sidebar-subtitle">å°ˆæ³¨é¢¨éšªãƒ»æ•¸æ“šé©…å‹•ãƒ»æ™ºèƒ½åˆ†æ</div>
    </div>
    
    <div class="menu-group">
        <div class="menu-group-title">ä¸»è¦åŠŸèƒ½</div>
        <a class="menu-item active" onclick="showPage('home', event)">
            <span class="menu-icon">ğŸ </span>
            <span class="menu-text">é¦–é </span>
        </a>
        <a class="menu-item" onclick="showPage('high-low-query', event)">
            <span class="menu-icon">ğŸ“Š</span>
            <span class="menu-text">CBæ›ç‰Œé«˜ä½æŸ¥è©¢</span>
        </a>
        <a class="menu-item" onclick="showPage('issue-query', event)">
            <span class="menu-icon">ğŸ“‹</span>
            <span class="menu-text">CBç™¼è¡ŒæŸ¥è©¢</span>
        </a>
        <a class="menu-item" onclick="showPage('company-query', event)">
            <span class="menu-icon">ğŸ¢</span>
            <span class="menu-text">CBåŒå…¬å¸ç™¼è¡ŒæŸ¥è©¢</span>
        </a>
    </div>
    
    <div class="menu-group">
        <div class="menu-group-title">æ‰¿éŠ·å°ˆå€</div>
        <a class="menu-item" onclick="showPage('board-announcement', event)">
            <span class="menu-icon">ğŸ“¢</span>
            <span class="menu-text">è‘£äº‹æœƒå…¬å‘Š</span>
        </a>
        <a class="menu-item" onclick="showPage('issue-cases', event)">
            <span class="menu-icon">ğŸ“„</span>
            <span class="menu-text">ç™¼è¡Œæ¡ˆä»¶</span>
        </a>
    </div>
    
    <div class="menu-group">
        <div class="menu-group-title">ç«¶æ‹å°ˆå€</div>
        <a class="menu-item" onclick="showPage('auction-query', event)">
            <span class="menu-icon">ğŸ”¨</span>
            <span class="menu-text">ç«¶æ‹æŸ¥è©¢</span>
        </a>
        <a class="menu-item" onclick="showPage('auction-batch', event)">
            <span class="menu-icon">ğŸ“‘</span>
            <span class="menu-text">ç«¶æ‹æ‰¹æ¬¡æŸ¥è©¢</span>
        </a>
        <a class="menu-item" onclick="showPage('condition-analysis', event)">
            <span class="menu-icon">ğŸ”</span>
            <span class="menu-text">ç™¼è¡Œçµ„åˆæ¢ä»¶åˆ†æ</span>
        </a>
    </div>
    
    <div class="menu-group">
        <div class="menu-group-title">çµ±è¨ˆåˆ†æ</div>
        <a class="menu-item" onclick="showPage('performance-analysis', event)">
            <span class="menu-icon">ğŸ“ˆ</span>
            <span class="menu-text">çµ„åˆç¸¾æ•ˆåˆ†æ</span>
        </a>
    </div>
    
    <div class="menu-group">
        <div class="menu-group-title">ğŸ“š ç ”ç©¶å ±å‘Šå°ˆå€</div>
        <a class="menu-item" onclick="showPage('industry-concept', event)">
            <span class="menu-icon">ğŸ­</span>
            <span class="menu-text">ç”¢æ¥­æ¦‚å¿µè‚¡æŸ¥è©¢</span>
        </a>
        <a class="menu-item" onclick="showPage('foreign-news', event)">
            <span class="menu-icon">ğŸŒ</span>
            <span class="menu-text">å¤–é›»å ±å°</span>
        </a>
        <a class="menu-item" onclick="showPage('stock-reports', event)">
            <span class="menu-icon">ğŸ“ˆ</span>
            <span class="menu-text">å€‹è‚¡ç ”ç©¶å ±å‘Š</span>
        </a>
        <a class="menu-item" onclick="showPage('industry-reports', event)">
            <span class="menu-icon">ğŸ“Š</span>
            <span class="menu-text">ç”¢æ¥­ç ”ç©¶å ±å‘Š</span>
        </a>
    </div>
</div>

<!-- é®ç½©å±¤ -->
<div id="overlay" class="overlay" onclick="closeMenu()"></div>

<!-- ä¸»å…§å®¹å€ -->
<main class="main-content">
    <!-- é¦–é  -->
    <div id="page-home" class="page-content active">
        <!-- æœå°‹å€ -->
        <div class="search-container">
            <div class="search-title">
                <span>ğŸ”</span>
                <span>æœå°‹é¢æ¿</span>
            </div>
            <div class="search-subtitle">è¼¸å…¥ä»£è™Ÿæˆ–åç¨±ï¼š</div>
            <input type="text" class="search-input" id="searchInput" 
                   placeholder="è«‹è¼¸å…¥CBä»£è™Ÿæˆ–åç¨±" 
                   value="23836"
                   inputmode="numeric">
            <button class="search-btn" onclick="performSearch()">é–‹å§‹æŸ¥è©¢</button>
            <div class="search-hint">â€» è«‹å…ˆè¼‰å…¥Excelæª”æ¡ˆ</div>
            
            <div class="file-upload-section">
                <label for="fileInput" class="action-btn primary">é¸æ“‡Excelæª”æ¡ˆ</label>
                <input type="file" class="file-input" id="fileInput" accept=".xlsx,.xls" multiple onchange="handleFiles(event)" style="display:none;">
                <div id="fileStatus" class="file-status"></div>
            </div>
        </div>
        
        <!-- å¿«é€ŸåŠŸèƒ½é€£çµ -->
        <div class="quick-links">
            <div class="quick-links-title">
                <span>âš¡</span>
                <span>å¿«é€ŸåŠŸèƒ½</span>
            </div>
            <div class="links-grid">
                <div class="link-card" onclick="showPage('high-low-query', event)">
                    <div class="link-icon">ğŸ“Š</div>
                    <div class="link-text">æ›ç‰Œé«˜ä½</div>
                </div>
                <div class="link-card" onclick="showPage('auction-query', event)">
                    <div class="link-icon">ğŸ”¨</div>
                    <div class="link-text">ç«¶æ‹æŸ¥è©¢</div>
                </div>
                <div class="link-card" onclick="showPage('company-query', event)">
                    <div class="link-icon">ğŸ¢</div>
                    <div class="link-text">åŒå…¬å¸æŸ¥è©¢</div>
                </div>
                <div class="link-card" onclick="showPage('condition-analysis', event)">
                    <div class="link-icon">ğŸ”</div>
                    <div class="link-text">æ¢ä»¶åˆ†æ</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- CBæ›ç‰Œé«˜ä½æŸ¥è©¢ -->
    <div id="page-high-low-query" class="page-content" style="display:none;">
        <div class="page-header">
            <h2 class="page-title">ğŸ“Š CBæ›ç‰Œé«˜ä½æŸ¥è©¢</h2>
            <p class="page-subtitle">æŸ¥è©¢CBçš„æ›ç‰Œæœ€é«˜åƒ¹ã€æœ€ä½åƒ¹åŠæŒ¯å¹…</p>
        </div>
        
        <div class="search-container">
            <input type="text" class="search-input" id="highLowSearchInput" 
                   placeholder="è¼¸å…¥CBä»£è™Ÿæˆ–åç¨±">
            <button class="search-btn" onclick="searchHighLow()">æŸ¥è©¢</button>
        </div>
        
        <div class="result-card" id="highLowResult" style="display:none;">
            <div class="result-header">
                <h3 id="hlResultName">--</h3>
                <span id="hlResultCode">--</span>
            </div>
            <div class="result-grid">
                <div class="result-item">
                    <div class="result-label">æ›ç‰Œæœ€é«˜</div>
                    <div class="result-value high" id="hlHigh">--</div>
                </div>
                <div class="result-item">
                    <div class="result-label">æ›ç‰Œæœ€ä½</div>
                    <div class="result-value low" id="hlLow">--</div>
                </div>
                <div class="result-item">
                    <div class="result-label">æŒ¯å¹…</div>
                    <div class="result-value amplitude" id="hlAmplitude">--%</div>
                </div>
                <div class="result-item">
                    <div class="result-label">å¹³å‡å¾—æ¨™</div>
                    <div class="result-value" id="hlAvgBid">--</div>
                </div>
            </div>
            
            <div class="performance-info">
                <h4>ç¸¾æ•ˆåˆ†æ</h4>
                <div class="info-row">
                    <span class="info-label">æœ€é«˜åƒ¹ç¸¾æ•ˆ</span>
                    <span class="info-value" id="hlHighPerf">--%</span>
                </div>
                <div class="info-row">
                    <span class="info-label">ç™¼è¡Œæ–¹å¼</span>
                    <span class="info-value" id="hlMethod">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">æ“”ä¿æƒ…å½¢</span>
                    <span class="info-value" id="hlSecurity">--</span>
                </div>
            </div>
        </div>
        
        <!-- æŒ¯å¹…æ’è¡Œæ¦œ -->
        <div class="list-section">
            <div class="list-header">
                <span>ğŸ“Š æŒ¯å¹…æ’è¡Œæ¦œ TOP 20</span>
                <button class="filter-btn" onclick="toggleAmplitudeFilter()">ç¯©é¸æ¢ä»¶</button>
            </div>
            
            <div class="filter-panel" id="amplitudeFilter" style="display:none;">
                <select id="securityFilter" onchange="updateAmplitudeRanking()">
                    <option value="all">å…¨éƒ¨</option>
                    <option value="secured">æœ‰æ“”ä¿</option>
                    <option value="unsecured">ç„¡æ“”ä¿</option>
                </select>
                <select id="methodFilter" onchange="updateAmplitudeRanking()">
                    <option value="all">å…¨éƒ¨</option>
                    <option value="auction">ç«¶æ‹</option>
                    <option value="book">è©¢åœˆ</option>
                </select>
            </div>
            
            <div id="amplitudeRanking" class="ranking-list">
                <!-- å‹•æ…‹ç”Ÿæˆæ’è¡Œæ¦œ -->
            </div>
        </div>
    </div>
    
    <!-- CBç™¼è¡ŒæŸ¥è©¢ -->
    <div id="page-issue-query" class="page-content" style="display:none;">
        <div class="page-header">
            <h2 class="page-title">ğŸ“‹ CBç™¼è¡ŒæŸ¥è©¢</h2>
            <p class="page-subtitle">æŸ¥è©¢CBçš„ç™¼è¡ŒåŸºæœ¬è³‡æ–™</p>
        </div>
        
        <div class="search-container">
            <input type="text" class="search-input" id="issueSearchInput" 
                   placeholder="è¼¸å…¥CBä»£è™Ÿæˆ–åç¨±">
            <button class="search-btn" onclick="searchIssue()">æŸ¥è©¢</button>
        </div>
        
        <div class="info-card" id="issueResult" style="display:none;">
            <div class="card-title" id="issueResultTitle">--</div>
            <div class="info-list" id="issueInfoList">
                <!-- å‹•æ…‹ç”Ÿæˆç™¼è¡Œè³‡æ–™ -->
            </div>
        </div>
    </div>
    
    <!-- CBåŒå…¬å¸ç™¼è¡ŒæŸ¥è©¢ -->
    <div id="page-company-query" class="page-content" style="display:none;">
        <div class="page-header">
            <h2 class="page-title">ğŸ¢ CBåŒå…¬å¸ç™¼è¡ŒæŸ¥è©¢</h2>
            <p class="page-subtitle">æŸ¥è©¢åŒä¸€å…¬å¸ç™¼è¡Œçš„æ‰€æœ‰CB</p>
        </div>
        
        <div class="search-container">
            <input type="text" class="search-input" id="companySearchInput" 
                   placeholder="è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿæˆ–å…¬å¸åç¨± (å¦‚: 6290 æˆ– è‰¯ç¶­)">
            <button class="search-btn" onclick="searchCompany()">æŸ¥è©¢</button>
        </div>
        
        <div class="company-result" id="companyResult" style="display:none;">
            <h3 id="companyName">--</h3>
            <p id="companyCount">å…±ç™¼è¡Œ 0 æª”CB</p>
            
            <div class="list-section">
                <div class="list-header">ç™¼è¡Œè¨˜éŒ„</div>
                <div id="companyCBList"></div>
            </div>
        </div>
    </div>
    
    <!-- è‘£äº‹æœƒå…¬å‘Š -->
    <div id="page-board-announcement" class="page-content" style="display:none;">
        <div class="page-header">
            <h2 class="page-title">ğŸ“¢ è‘£äº‹æœƒå…¬å‘Š</h2>
            <p class="page-subtitle">æœ€æ–°è‘£äº‹æœƒé€šéç™¼è¡ŒCBå…¬å‘Š</p>
        </div>
        
        <div class="filter-section">
            <select class="filter-select" id="boardYearFilter">
                <option value="all">å…¨éƒ¨å¹´ä»½</option>
                <option value="2024">2024å¹´</option>
                <option value="2023">2023å¹´</option>
            </select>
            
            <select class="filter-select" id="boardMonthFilter">
                <option value="all">å…¨éƒ¨æœˆä»½</option>
                <option value="1">1æœˆ</option>
                <option value="2">2æœˆ</option>
                <!-- å…¶ä»–æœˆä»½ -->
            </select>
        </div>
        
        <div class="announcement-list" id="boardList">
            <!-- å‹•æ…‹ç”Ÿæˆå…¬å‘Šåˆ—è¡¨ -->
        </div>
    </div>
    
    <!-- ç™¼è¡Œæ¡ˆä»¶ -->
    <div id="page-issue-cases" class="page-content" style="display:none;">
        <div class="page-header">
            <h2 class="page-title">ğŸ“„ ç™¼è¡Œæ¡ˆä»¶</h2>
            <p class="page-subtitle">CBç™¼è¡Œæ¡ˆä»¶é€²åº¦è¿½è¹¤</p>
        </div>
        
        <div class="status-tabs">
            <button class="status-tab active" onclick="filterIssueStatus('all')">å…¨éƒ¨</button>
            <button class="status-tab" onclick="filterIssueStatus('pending')">å¾…ç™¼è¡Œ</button>
            <button class="status-tab" onclick="filterIssueStatus('issued')">å·²ç™¼è¡Œ</button>
        </div>
        
        <div class="issue-cases-list" id="issueCasesList">
            <!-- å‹•æ…‹ç”Ÿæˆæ¡ˆä»¶åˆ—è¡¨ -->
        </div>
    </div>
    
    <!-- ====== ç ”ç©¶å ±å‘Šå°ˆå€ ====== -->
    <!-- ç”¢æ¥­æ¦‚å¿µè‚¡æŸ¥è©¢ -->
    <div id="page-industry-concept" class="page-content" style="display:none;">
        <div class="page-header">
            <h2 class="page-title">ğŸ­ ç”¢æ¥­æ¦‚å¿µè‚¡æŸ¥è©¢</h2>
            <p class="page-subtitle">æŸ¥è©¢ç”¢æ¥­åˆ†é¡åŠæ¦‚å¿µè‚¡æ—ç¾¤</p>
        </div>
        
        <div class="search-container">
            <input type="text" class="search-input" id="industrySearchInput" 
                   placeholder="è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿã€å…¬å¸åç¨±æˆ–ç”¢æ¥­é—œéµå­—">
            <button class="search-btn" onclick="searchIndustryConcept()">æŸ¥è©¢</button>
        </div>
        
        <!-- ç”¢æ¥­åˆ†é¡æ¨™ç±¤ -->
        <div class="industry-tags" id="industryTags">
            <span class="tag-item" onclick="searchByIndustry('åŠå°é«”')">åŠå°é«”</span>
            <span class="tag-item" onclick="searchByIndustry('é›»å­é›¶çµ„ä»¶')">é›»å­é›¶çµ„ä»¶</span>
            <span class="tag-item" onclick="searchByIndustry('å…‰é›»æ¥­')">å…‰é›»æ¥­</span>
            <span class="tag-item" onclick="searchByIndustry('ç”ŸæŠ€é†«ç™‚')">ç”ŸæŠ€é†«ç™‚</span>
            <span class="tag-item" onclick="searchByIndustry('é£Ÿå“å·¥æ¥­')">é£Ÿå“å·¥æ¥­</span>
        </div>
        
        <div class="result-container" id="industryConceptResult" style="display:none;">
            <div class="result-card">
                <h3 id="icCompanyName">--</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">è‚¡ç¥¨ä»£è™Ÿ</span>
                        <span class="info-value" id="icStockCode">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">å¸‚å ´</span>
                        <span class="info-value" id="icMarket">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ç”¢æ¥­</span>
                        <span class="info-value" id="icIndustry">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ç´°ç”¢æ¥­</span>
                        <span class="info-value" id="icSubIndustry">--</span>
                    </div>
                </div>
                <div class="industry-position" id="icPosition">--</div>
            </div>
            
            <div class="concept-list" id="conceptStockList">
                <h4>ç›¸é—œæ¦‚å¿µè‚¡</h4>
                <div id="conceptItems"></div>
            </div>
        </div>
    </div>
    
    <!-- å¤–é›»å ±å° -->
    <div id="page-foreign-news" class="page-content" style="display:none;">
        <div class="page-header">
            <h2 class="page-title">ğŸŒ å¤–é›»å ±å°</h2>
            <p class="page-subtitle">åœ‹éš›åª’é«”åŠåˆ¸å•†å ±å°è¿½è¹¤</p>
        </div>
        
        <div class="filter-section">
            <select class="filter-select" id="newsTypeFilter" onchange="filterForeignNews()">
                <option value="all">å…¨éƒ¨é¡å‹</option>
                <option value="é‡è¦">é‡è¦å ±å°</option>
                <option value="ä¸€èˆ¬">ä¸€èˆ¬å ±å°</option>
            </select>
            
            <select class="filter-select" id="newsDateFilter" onchange="filterForeignNews()">
                <option value="all">å…¨éƒ¨æ™‚é–“</option>
                <option value="7">æœ€è¿‘7å¤©</option>
                <option value="30">æœ€è¿‘30å¤©</option>
                <option value="90">æœ€è¿‘90å¤©</option>
            </select>
            
            <input type="text" class="search-input" id="newsSearchInput" 
                   placeholder="æœå°‹å…¬å¸åç¨±æˆ–é—œéµå­—" onkeyup="searchForeignNews()">
        </div>
        
        <div class="news-list" id="foreignNewsList">
            <!-- å‹•æ…‹ç”Ÿæˆæ–°èåˆ—è¡¨ -->
        </div>
    </div>
    
    <!-- å€‹è‚¡ç ”ç©¶å ±å‘Š -->
    <div id="page-stock-reports" class="page-content" style="display:none;">
        <div class="page-header">
            <h2 class="page-title">ğŸ“ˆ å€‹è‚¡ç ”ç©¶å ±å‘Š</h2>
            <p class="page-subtitle">åˆ¸å•†å€‹è‚¡ç ”ç©¶å ±å‘Šå½™æ•´</p>
        </div>
        
        <div class="search-container">
            <input type="text" class="search-input" id="stockReportSearchInput" 
                   placeholder="è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿæˆ–å…¬å¸åç¨±">
            <button class="search-btn" onclick="searchStockReport()">æŸ¥è©¢</button>
        </div>
        
        <div class="filter-section">
            <select class="filter-select" id="reportRatingFilter" onchange="filterStockReports()">
                <option value="all">å…¨éƒ¨è©•ç­‰</option>
                <option value="è²·é€²">è²·é€²</option>
                <option value="ä¸­ç«‹">ä¸­ç«‹</option>
                <option value="è³£å‡º">è³£å‡º</option>
            </select>
            
            <select class="filter-select" id="reportImportanceFilter" onchange="filterStockReports()">
                <option value="all">å…¨éƒ¨é‡è¦æ€§</option>
                <option value="é«˜">é«˜åº¦é‡è¦</option>
                <option value="ä¸­">ä¸­åº¦é‡è¦</option>
                <option value="ä½">ä¸€èˆ¬</option>
            </select>
        </div>
        
        <div class="reports-list" id="stockReportsList">
            <!-- å‹•æ…‹ç”Ÿæˆå ±å‘Šåˆ—è¡¨ -->
        </div>
    </div>
    
    <!-- ç”¢æ¥­ç ”ç©¶å ±å‘Š -->
    <div id="page-industry-reports" class="page-content" style="display:none;">
        <div class="page-header">
            <h2 class="page-title">ğŸ“Š ç”¢æ¥­ç ”ç©¶å ±å‘Š</h2>
            <p class="page-subtitle">ç”¢æ¥­è¶¨å‹¢æ·±åº¦åˆ†æå ±å‘Š</p>
        </div>
        
        <div class="coming-soon">
            <div class="coming-icon">ğŸš§</div>
            <h3>åŠŸèƒ½é–‹ç™¼ä¸­</h3>
            <p>ç”¢æ¥­ç ”ç©¶å ±å‘ŠåŠŸèƒ½å³å°‡æ¨å‡ºï¼Œæ•¬è«‹æœŸå¾…ï¼</p>
        </div>
    </div>
    
    <!-- ç«¶æ‹æŸ¥è©¢ -->
    <div id="page-auction-query" class="page-content" style="display:none;">
        <div class="page-header">
            <h2 class="page-title">ğŸ”¨ ç«¶æ‹æŸ¥è©¢</h2>
            <p class="page-subtitle">æŸ¥è©¢å–®æª”CBç«¶æ‹è©³ç´°è³‡æ–™</p>
        </div>
        
        <div class="search-container">
            <input type="text" class="search-input" id="auctionSearchInput" 
                   placeholder="è¼¸å…¥CBä»£è™Ÿæˆ–åç¨±">
            <button class="search-btn" onclick="searchAuction()">æŸ¥è©¢</button>
        </div>
        
        <div class="auction-result" id="auctionResult" style="display:none;">
            <!-- ç«¶æ‹çµæœè©³æƒ… -->
        </div>
    </div>
    
    <!-- ç«¶æ‹æ‰¹æ¬¡æŸ¥è©¢ -->
    <div id="page-auction-batch" class="page-content" style="display:none;">
        <div class="page-header">
            <h2 class="page-title">ğŸ“‘ ç«¶æ‹æ‰¹æ¬¡æŸ¥è©¢</h2>
            <p class="page-subtitle">åŒæ™‚æŸ¥è©¢å¤šæª”CBç«¶æ‹è³‡æ–™ï¼ˆæœ€å¤š10æª”ï¼‰</p>
        </div>
        
        <div class="batch-input-section">
            <div class="batch-input-grid" id="batchInputs">
                <input type="text" class="batch-input" placeholder="CBä»£è™Ÿ 1">
                <input type="text" class="batch-input" placeholder="CBä»£è™Ÿ 2">
                <input type="text" class="batch-input" placeholder="CBä»£è™Ÿ 3">
                <input type="text" class="batch-input" placeholder="CBä»£è™Ÿ 4">
                <input type="text" class="batch-input" placeholder="CBä»£è™Ÿ 5">
            </div>
            <button class="add-input-btn" onclick="addBatchInput()">+ æ–°å¢æ¬„ä½</button>
            <button class="search-btn" onclick="searchBatch()">æ‰¹æ¬¡æŸ¥è©¢</button>
        </div>
        
        <div class="batch-result-table" id="batchResult" style="display:none;">
            <!-- æ‰¹æ¬¡æŸ¥è©¢çµæœè¡¨æ ¼ -->
        </div>
    </div>
    
    <!-- ç™¼è¡Œçµ„åˆæ¢ä»¶åˆ†æ -->
    <div id="page-condition-analysis" class="page-content" style="display:none;">
        <div class="page-header">
            <h2 class="page-title">ğŸ” ç™¼è¡Œçµ„åˆæ¢ä»¶åˆ†æ</h2>
            <p class="page-subtitle">æ ¹æ“šç™¼è¡Œæ¢ä»¶çµ„åˆç¯©é¸CB</p>
        </div>
        
        <div class="condition-filters">
            <div class="filter-group">
                <h3>åŸºæœ¬æ¢ä»¶</h3>
                <label>
                    ç™¼è¡Œå¹´æœŸï¼š
                    <select id="yearFilter">
                        <option value="">ä¸é™</option>
                        <option value="3">3å¹´æœŸ</option>
                        <option value="5">5å¹´æœŸ</option>
                        <option value="7">7å¹´æœŸ</option>
                    </select>
                </label>
                
                <label>
                    æ“”ä¿æƒ…å½¢ï¼š
                    <select id="securityFilter">
                        <option value="">ä¸é™</option>
                        <option value="secured">æœ‰æ“”ä¿</option>
                        <option value="unsecured">ç„¡æ“”ä¿</option>
                    </select>
                </label>
            </div>
            
            <div class="filter-group">
                <h3>æŠ•æ¨™å€æ•¸</h3>
                <label>
                    <input type="radio" name="bidMultiple" value="all" checked> å…¨éƒ¨
                </label>
                <label>
                    <input type="radio" name="bidMultiple" value="<1"> &lt;1å€ï¼ˆæ¥µåº¦å†·æ¸…ï¼‰
                </label>
                <label>
                    <input type="radio" name="bidMultiple" value="1-1.5"> 1-1.5å€ï¼ˆå†·æ¸…ï¼‰
                </label>
                <label>
                    <input type="radio" name="bidMultiple" value="1.5-2.5"> 1.5-2.5å€ï¼ˆæ™®é€šï¼‰
                </label>
                <label>
                    <input type="radio" name="bidMultiple" value="2.5-4"> 2.5-4å€ï¼ˆç«ç†±ï¼‰
                </label>
                <label>
                    <input type="radio" name="bidMultiple" value=">4"> &gt;4å€ï¼ˆæ¥µåº¦ç«ç†±ï¼‰
                </label>
            </div>
            
            <button class="filter-btn" onclick="analyzeConditions()">é–‹å§‹åˆ†æ</button>
        </div>
        
        <div class="analysis-result" id="analysisResult" style="display:none;">
            <!-- åˆ†æçµæœ -->
        </div>
    </div>
    
    <!-- çµ„åˆç¸¾æ•ˆåˆ†æ -->
    <div id="page-performance-analysis" class="page-content" style="display:none;">
        <div class="page-header">
            <h2 class="page-title">ğŸ“ˆ çµ„åˆç¸¾æ•ˆåˆ†æ</h2>
            <p class="page-subtitle">åˆ†æä¸åŒæ¢ä»¶çµ„åˆçš„æ­·å²ç¸¾æ•ˆè¡¨ç¾</p>
        </div>
        
        <div class="performance-summary">
            <!-- ç¸¾æ•ˆçµ±è¨ˆæ‘˜è¦ -->
        </div>
        
        <div class="chart-section">
            <div class="chart-container" id="performanceChart" style="height: 400px;"></div>
        </div>
        
        <div class="performance-ranking" id="performanceRanking">
            <!-- ç¸¾æ•ˆæ’ååˆ—è¡¨ -->
        </div>
    </div>
</main>
```

<script>
// å…¨åŸŸè®Šæ•¸
let cbDatabase = {};        // CBåŸºæœ¬è³‡æ–™
let highLowData = {};      // CBæ›ç‰Œé«˜ä½è³‡æ–™ï¼ˆå¾00å·¥ä½œè¡¨è®€å–ï¼‰
let auctionData = {};      // CBç«¶æ‹è³‡æ–™ï¼ˆå¾04å·¥ä½œè¡¨è®€å–ï¼‰
let cbasData = {};         // CBASè³‡æ–™
let priceData = {};        // åƒ¹æ ¼è³‡æ–™
let currentCB = '23836';
let priceChart = null;
let cbasChart = null;      // CBASåœ–è¡¨
let filesLoaded = {
    cb: false,
    cbas: false,
    price: false
};

// å´é‚Šé¸å–®æ§åˆ¶
function toggleMenu() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    sidebar.classList.toggle('active');
    overlay.classList.toggle('active');
}

function closeMenu() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    sidebar.classList.remove('active');
    overlay.classList.remove('active');
}

// é é¢åˆ‡æ›
function showPage(pageName, event) {
    closeMenu();
    
    // éš±è—æ‰€æœ‰é é¢
    document.querySelectorAll('.page-content').forEach(page => {
        page.style.display = 'none';
    });
    
    // é¡¯ç¤ºé¸ä¸­çš„é é¢
    const targetPage = document.getElementById(`page-${pageName}`);
    if (targetPage) {
        targetPage.style.display = 'block';
    }
    
    // æ›´æ–°é¸å–®ç‹€æ…‹
    document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // ä½¿ç”¨å‚³å…¥çš„eventåƒæ•¸
    if (event && event.currentTarget) {
        event.currentTarget.classList.add('active');
    } else if (event && event.target) {
        event.target.closest('.menu-item').classList.add('active');
    }
    
    // æ ¹æ“šé é¢åˆå§‹åŒ–å…§å®¹
    switch(pageName) {
        case 'high-low-query':
            initHighLowQuery();
            break;
        case 'issue-query':
            initIssueQuery();
            break;
        case 'company-query':
            initCompanyQuery();
            break;
        case 'board-announcement':
            initBoardAnnouncement();
            break;
        case 'issue-cases':
            initIssueCases();
            break;
        case 'auction-query':
            initAuctionQuery();
            break;
        case 'auction-batch':
            initAuctionBatch();
            break;
        case 'condition-analysis':
            initConditionAnalysis();
            break;
        case 'performance-analysis':
            initPerformanceAnalysis();
            break;
        case 'industry-concept':
            initIndustryConcept();
            break;
        case 'foreign-news':
            initForeignNews();
            break;
        case 'stock-reports':
            initStockReports();
            break;
        case 'industry-reports':
            initIndustryReports();
            break;
    }
}

// åˆå§‹åŒ–æ’è¡Œæ¦œ
function initRanking() {
    const firstTab = document.querySelector('.ranking-tab');
    showRanking('premium', {target: firstTab});
}

// é¡¯ç¤ºä¸åŒé¡å‹çš„æ’è¡Œ
function showRanking(type, event) {
    document.querySelectorAll('.ranking-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    if (event && event.currentTarget) {
        event.currentTarget.classList.add('active');
    } else if (event && event.target) {
        event.target.classList.add('active');
    }
    
    const rankingList = document.getElementById('rankingList');
    if (!rankingList) return;
    
    let html = '';
    
    // æ¨¡æ“¬ä¸åŒé¡å‹çš„æ’è¡Œæ¦œè³‡æ–™
    const mockData = {
        premium: [
            {name: 'å°å…‰é›»å…­', code: '23836', value: '-3.2%'},
            {name: 'å°æ³¥ä¸€', code: '11011', value: '-1.5%'},
            {name: 'ä¸Šæ›œå…­', code: '13166', value: '2.3%'},
        ],
        volume: [
            {name: 'å°ç©é›»ä¸€', code: '23301', value: '15,234'},
            {name: 'è¯é›»äºŒ', code: '23032', value: '12,456'},
            {name: 'é´»æµ·ä¸‰', code: '23173', value: '9,876'},
        ],
        change: [
            {name: 'é™½æ˜äº”', code: '26095', value: '+5.8%'},
            {name: 'é•·æ¦®ä¸‰', code: '26033', value: '+4.2%'},
            {name: 'è¬æµ·äºŒ', code: '26152', value: '+3.6%'},
        ],
        cbas: [
            {name: 'è¯èˆªä¸€', code: '26101', value: '12.5'},
            {name: 'ä¸­é‹¼å››', code: '20234', value: '10.8'},
            {name: 'å°å¡‘äºŒ', code: '13012', value: '9.2'},
        ]
    };
    
    const data = mockData[type] || [];
    
    data.forEach((item, index) => {
        const isUp = item.value.includes('+');
        const colorClass = isUp ? 'up' : (item.value.includes('-') ? 'down' : '');
        
        html += `
            <div class="list-item" onclick="selectCB('${item.code}')">
                <div class="list-item-left">
                    <div class="list-item-name">${index + 1}. ${item.name}</div>
                    <div class="list-item-code">${item.code}</div>
                </div>
                <div class="list-item-right">
                    <div class="list-item-price ${colorClass}">${item.value}</div>
                </div>
            </div>
        `;
    });
    
    rankingList.innerHTML = html;
}

// åˆå§‹åŒ–CBASé é¢
function initCBAS() {
    setTimeout(() => {
        const cbasChartDom = document.getElementById('cbasChart');
        if (!cbasChartDom) return;
        
        if (!cbasChart) {
            cbasChart = echarts.init(cbasChartDom);
        }
        
        // è¼‰å…¥CBASåœ–è¡¨
        const option = {
            grid: {
                left: 50,
                right: 20,
                top: 20,
                bottom: 40
            },
            xAxis: {
                type: 'category',
                data: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
                axisLabel: {
                    fontSize: 10
                }
            },
            yAxis: {
                type: 'value',
                name: 'æ¬Šåˆ©é‡‘',
                axisLabel: {
                    fontSize: 10
                }
            },
            series: [{
                data: [8.5, 7.8, 9.2, 8.6, 7.5, 8.1],
                type: 'line',
                smooth: true,
                lineStyle: {
                    width: 2,
                    color: '#ff9800'
                },
                areaStyle: {
                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                        { offset: 0, color: 'rgba(255,152,0,0.3)' },
                        { offset: 1, color: 'rgba(255,152,0,0)' }
                    ])
                }
            }]
        };
        
        cbasChart.setOption(option);
    }, 100);
}

// åˆå§‹åŒ–å…¶ä»–åŠŸèƒ½
function initAnalysis() { console.log('åˆå§‹åŒ–æŠ€è¡“åˆ†æé é¢'); }
function initComparison() { console.log('åˆå§‹åŒ–æ¯”è¼ƒå·¥å…·'); }
function initFilter() { console.log('åˆå§‹åŒ–æ¢ä»¶ç¯©é¸'); }
function initAlert() { console.log('åˆå§‹åŒ–åƒ¹æ ¼æé†’'); }
function initPortfolio() { console.log('åˆå§‹åŒ–æŠ•è³‡çµ„åˆ'); }
function initExport() { console.log('åˆå§‹åŒ–å ±è¡¨åŒ¯å‡º'); }

// ===== æ–°åŠŸèƒ½åˆå§‹åŒ–å‡½æ•¸ =====

// CBæ›ç‰Œé«˜ä½æŸ¥è©¢
function initHighLowQuery() {
    // åˆå§‹åŒ–æ™‚æª¢æŸ¥æ˜¯å¦å·²æœ‰è³‡æ–™
    if (typeof highLowData !== 'undefined' && Object.keys(highLowData).length > 0) {
        updateAmplitudeRanking();
    }
}

function searchHighLow() {
    const input = document.getElementById('highLowSearchInput').value.trim();
    if (!input) {
        alert('è«‹è¼¸å…¥CBä»£è™Ÿæˆ–åç¨±');
        return;
    }
    
    // æª¢æŸ¥è³‡æ–™æ˜¯å¦å·²è¼‰å…¥
    if (typeof highLowData === 'undefined' || Object.keys(highLowData).length === 0) {
        alert('è«‹å…ˆè¼‰å…¥Excelæª”æ¡ˆï¼ˆ00æª”æ¡ˆï¼‰');
        return;
    }
    
    // æœå°‹é‚è¼¯ - å¾ highLowData æŸ¥æ‰¾
    let found = null;
    
    // å…ˆç”¨CBä»£è™ŸæŸ¥è©¢
    if (highLowData[input]) {
        found = { code: input, ...highLowData[input] };
    } else {
        // ç”¨åç¨±æŸ¥è©¢
        for (let code in highLowData) {
            if (highLowData[code].name && highLowData[code].name.includes(input)) {
                found = { code: code, ...highLowData[code] };
                break;
            }
        }
    }
    
    if (found) {
        displayHighLowResult(found);
    } else {
        alert('æŸ¥ç„¡æ­¤CBè³‡æ–™');
    }
}

function displayHighLowResult(cbData) {
    document.getElementById('hlResultName').textContent = cbData.name || '--';
    document.getElementById('hlResultCode').textContent = cbData.code || '--';
    document.getElementById('hlHigh').textContent = cbData.high ? cbData.high.toFixed(2) : '--';
    document.getElementById('hlLow').textContent = cbData.low ? cbData.low.toFixed(2) : '--';
    
    // è¨ˆç®—æŒ¯å¹…
    if (cbData.high && cbData.low && cbData.low > 0) {
        const amplitude = ((cbData.high - cbData.low) / cbData.low * 100).toFixed(2);
        document.getElementById('hlAmplitude').textContent = amplitude + '%';
    } else {
        document.getElementById('hlAmplitude').textContent = '--';
    }
    
    document.getElementById('hlAvgBid').textContent = cbData.avgBid ? cbData.avgBid.toFixed(2) : '--';
    
    // è¨ˆç®—ç¸¾æ•ˆ
    if (cbData.high && cbData.avgBid) {
        const performance = ((cbData.high - cbData.avgBid) / cbData.avgBid * 100).toFixed(2);
        document.getElementById('hlHighPerf').textContent = '+' + performance + '%';
    } else {
        document.getElementById('hlHighPerf').textContent = '--';
    }
    
    document.getElementById('hlMethod').textContent = cbData.method || '--';
    document.getElementById('hlSecurity').textContent = cbData.security || '--';
    
    document.getElementById('highLowResult').style.display = 'block';
}

function toggleAmplitudeFilter() {
    const filter = document.getElementById('amplitudeFilter');
    filter.style.display = filter.style.display === 'none' ? 'block' : 'none';
}

function updateAmplitudeRanking() {
    // æª¢æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
    const rankingDiv = document.getElementById('amplitudeRanking');
    if (!rankingDiv) return;
    
    // æª¢æŸ¥è³‡æ–™æ˜¯å¦å·²è¼‰å…¥
    if (!highLowData || Object.keys(highLowData).length === 0) {
        rankingDiv.innerHTML = '<div style="text-align:center;padding:20px;color:#999;">è«‹å…ˆè¼‰å…¥Excelæª”æ¡ˆ</div>';
        return;
    }
    
    const securityFilter = document.getElementById('securityFilter')?.value || 'all';
    const methodFilter = document.getElementById('methodFilter')?.value || 'all';
    
    // ç¯©é¸ä¸¦æ’åºè³‡æ–™
    let filtered = [];
    for (let code in highLowData) {
        const data = highLowData[code];
        
        // ç¯©é¸æ¢ä»¶
        if (securityFilter !== 'all') {
            if (securityFilter === 'secured' && !data.security?.includes('æœ‰')) continue;
            if (securityFilter === 'unsecured' && !data.security?.includes('ç„¡')) continue;
        }
        
        if (methodFilter !== 'all') {
            if (methodFilter === 'auction' && data.method !== 'ç«¶æ‹') continue;
            if (methodFilter === 'book' && data.method !== 'è©¢åœˆ') continue;
        }
        
        // è¨ˆç®—æŒ¯å¹…
        if (data.high && data.low && data.low > 0) {
            const amplitude = (data.high - data.low) / data.low * 100;
            filtered.push({
                code: code,
                name: data.name,
                high: data.high,
                low: data.low,
                amplitude: amplitude
            });
        }
    }
    
    // æŒ‰æŒ¯å¹…æ’åºï¼ˆå¾å¤§åˆ°å°ï¼‰
    filtered.sort((a, b) => b.amplitude - a.amplitude);
    
    // åªå–å‰20å
    const top20 = filtered.slice(0, 20);
    
    // ç”ŸæˆHTML
    let html = '';
    top20.forEach((item, index) => {
        html += `
            <div class="ranking-item" onclick="quickSearchHighLow('${item.code}')">
                <div class="ranking-number">${index + 1}</div>
                <div class="ranking-info">
                    <div class="ranking-name">${item.name}</div>
                    <div class="ranking-code">${item.code}</div>
                </div>
                <div class="ranking-value">${item.amplitude.toFixed(1)}%</div>
            </div>
        `;
    });
    
    if (rankingDiv) {
        rankingDiv.innerHTML = html || '<div style="text-align:center;padding:20px;color:#999;">ç„¡ç¬¦åˆæ¢ä»¶çš„è³‡æ–™</div>';
    }
}

function quickSearchHighLow(code) {
    document.getElementById('highLowSearchInput').value = code;
    searchHighLow();
}

// CBç™¼è¡ŒæŸ¥è©¢
function initIssueQuery() {
    console.log('åˆå§‹åŒ–ç™¼è¡ŒæŸ¥è©¢');
}

function searchIssue() {
    const input = document.getElementById('issueSearchInput').value.trim();
    if (!input) {
        alert('è«‹è¼¸å…¥CBä»£è™Ÿæˆ–åç¨±');
        return;
    }
    
    // é¡¯ç¤ºçµæœ
    document.getElementById('issueResultTitle').textContent = 'æŸ¥è©¢çµæœ';
    document.getElementById('issueResult').style.display = 'block';
}

// CBåŒå…¬å¸ç™¼è¡ŒæŸ¥è©¢
function initCompanyQuery() {
    console.log('åˆå§‹åŒ–åŒå…¬å¸æŸ¥è©¢');
}

function searchCompany() {
    const input = document.getElementById('companySearchInput').value.trim();
    if (!input) {
        alert('è«‹è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿæˆ–å…¬å¸åç¨±');
        return;
    }
    
    // æ¨¡æ“¬æŸ¥è©¢çµæœ
    const mockResults = {
        '6290': {
            company: 'è‰¯ç¶­ç§‘æŠ€',
            cbs: [
                {code: '62901', name: 'è‰¯ç¶­ä¸€'},
                {code: '62902', name: 'è‰¯ç¶­äºŒ'},
                {code: '62903', name: 'è‰¯ç¶­ä¸‰'},
                {code: '62904', name: 'è‰¯ç¶­å››'},
                {code: '62905', name: 'è‰¯ç¶­äº”'},
            ]
        }
    };
    
    const result = mockResults[input];
    if (result) {
        displayCompanyResult(result);
    }
}

function displayCompanyResult(result) {
    document.getElementById('companyName').textContent = result.company;
    document.getElementById('companyCount').textContent = `å…±ç™¼è¡Œ ${result.cbs.length} æª”CB`;
    
    let html = '';
    result.cbs.forEach(cb => {
        html += `
            <div class="list-item" onclick="selectCB('${cb.code}')">
                <div class="list-item-left">
                    <div class="list-item-name">${cb.name}</div>
                    <div class="list-item-code">${cb.code}</div>
                </div>
                <div class="list-item-right">
                    <div class="list-item-price">æŸ¥çœ‹è©³æƒ…</div>
                </div>
            </div>
        `;
    });
    
    document.getElementById('companyCBList').innerHTML = html;
    document.getElementById('companyResult').style.display = 'block';
}

// è‘£äº‹æœƒå…¬å‘Š
function initBoardAnnouncement() {
    console.log('åˆå§‹åŒ–è‘£äº‹æœƒå…¬å‘Š');
}

// ç™¼è¡Œæ¡ˆä»¶
function initIssueCases() {
    console.log('åˆå§‹åŒ–ç™¼è¡Œæ¡ˆä»¶');
}

// ç«¶æ‹æŸ¥è©¢
function initAuctionQuery() {
    console.log('åˆå§‹åŒ–ç«¶æ‹æŸ¥è©¢');
}

function searchAuction() {
    const input = document.getElementById('auctionSearchInput').value.trim();
    if (!input) {
        alert('è«‹è¼¸å…¥CBä»£è™Ÿæˆ–åç¨±');
        return;
    }
}

// ç«¶æ‹æ‰¹æ¬¡æŸ¥è©¢
function initAuctionBatch() {
    console.log('åˆå§‹åŒ–æ‰¹æ¬¡æŸ¥è©¢');
}

function addBatchInput() {
    const grid = document.getElementById('batchInputs');
    const currentInputs = grid.querySelectorAll('.batch-input').length;
    
    if (currentInputs < 10) {
        const newInput = document.createElement('input');
        newInput.type = 'text';
        newInput.className = 'batch-input';
        newInput.placeholder = `CBä»£è™Ÿ ${currentInputs + 1}`;
        grid.appendChild(newInput);
    } else {
        alert('æœ€å¤šåªèƒ½æŸ¥è©¢10æª”CB');
    }
}

function searchBatch() {
    const inputs = document.querySelectorAll('.batch-input');
    const codes = [];
    
    inputs.forEach(input => {
        if (input.value.trim()) {
            codes.push(input.value.trim());
        }
    });
    
    if (codes.length === 0) {
        alert('è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹CBä»£è™Ÿ');
        return;
    }
    
    console.log('æ‰¹æ¬¡æŸ¥è©¢:', codes);
}

// ç™¼è¡Œçµ„åˆæ¢ä»¶åˆ†æ
function initConditionAnalysis() {
    console.log('åˆå§‹åŒ–æ¢ä»¶åˆ†æ');
}

function analyzeConditions() {
    const yearFilter = document.getElementById('yearFilter').value;
    const securityFilter = document.getElementById('securityFilter').value;
    const bidMultiple = document.querySelector('input[name="bidMultiple"]:checked').value;
    
    console.log('åˆ†ææ¢ä»¶:', {
        year: yearFilter,
        security: securityFilter,
        bidMultiple: bidMultiple
    });
}

// çµ„åˆç¸¾æ•ˆåˆ†æ
function initPerformanceAnalysis() {
    console.log('åˆå§‹åŒ–ç¸¾æ•ˆåˆ†æ');
    
    // åˆå§‹åŒ–ç¸¾æ•ˆåœ–è¡¨
    setTimeout(() => {
        const chartDom = document.getElementById('performanceChart');
        if (chartDom) {
            const performanceChart = echarts.init(chartDom);
            
            const option = {
                title: {
                    text: 'å„æŠ•æ¨™å€æ•¸å€é–“å¹³å‡ç¸¾æ•ˆ',
                    left: 'center'
                },
                xAxis: {
                    type: 'category',
                    data: ['<1å€', '1-1.5å€', '1.5-2.5å€', '2.5-4å€', '>4å€']
                },
                yAxis: {
                    type: 'value',
                    name: 'å¹³å‡ç¸¾æ•ˆ(%)'
                },
                series: [
                    {
                        name: 'æœ‰æ“”ä¿',
                        type: 'bar',
                        data: [19.92, 30.67, 45.31, 89.12, 53.51],
                        itemStyle: { color: '#34a853' }
                    },
                    {
                        name: 'ç„¡æ“”ä¿',
                        type: 'bar',
                        data: [57.32, 42.22, 43.97, 44.30, 56.73],
                        itemStyle: { color: '#ff9800' }
                    }
                ]
            };
            
            performanceChart.setOption(option);
        }
    }, 100);
}

// è™•ç†æª”æ¡ˆä¸Šå‚³
function handleFiles(event) {
    const files = event.target.files;
    if (!files || files.length === 0) return;
    
    document.getElementById('fileStatus').innerHTML = '<span style="color:#1a73e8;">è®€å–æª”æ¡ˆä¸­...</span>';
    
    let processedFiles = 0;
    const totalFiles = files.length;
    
    Array.from(files).forEach(file => {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                
                // æ ¹æ“šæª”æ¡ˆåç¨±åˆ¤æ–·é¡å‹
                const fileName = file.name.toLowerCase();
                console.log('è¼‰å…¥æª”æ¡ˆ:', fileName);
                console.log('å·¥ä½œè¡¨:', workbook.SheetNames);
                
                // è™•ç†00æª”æ¡ˆï¼ˆä¸»è¦è³‡æ–™æª”ï¼‰
                if (fileName.includes('00') || fileName.includes('ä¸»æª”') || fileName.includes('cbè³‡æ–™')) {
                    process00File(workbook);
                }
                // è™•ç†01æª”æ¡ˆï¼ˆCBASè³‡æ–™ï¼‰
                else if (fileName.includes('01') || fileName.includes('cbas')) {
                    processCBASFile(workbook);
                }
                // è™•ç†02æª”æ¡ˆï¼ˆåƒ¹æ ¼è³‡æ–™ï¼‰
                else if (fileName.includes('02') || fileName.includes('åƒ¹æ ¼') || fileName.includes('price')) {
                    processPriceFile(workbook);
                }
                
                processedFiles++;
                if (processedFiles === totalFiles) {
                    document.getElementById('fileStatus').innerHTML = 
                        '<span style="color:#34a853;">âœ… æª”æ¡ˆè¼‰å…¥æˆåŠŸ</span>';
                    
                    // æ›´æ–°è³‡æ–™åº«æ•¸é‡é¡¯ç¤º
                    const totalCBs = Object.keys(highLowData).length || Object.keys(cbDatabase).length;
                    document.getElementById('dataBadge').textContent = 
                        `è³‡æ–™åº«å°±ç·’ (å…± ${totalCBs} æª”)`;
                    
                    // é‡æ–°è¼‰å…¥ç•¶å‰é é¢çš„è³‡æ–™
                    const activePage = document.querySelector('.page-content.active');
                    if (activePage && activePage.id === 'page-high-low-query') {
                        updateAmplitudeRanking();
                    }
                }
                
            } catch (error) {
                console.error('æª”æ¡ˆè™•ç†éŒ¯èª¤:', error);
                document.getElementById('fileStatus').innerHTML = 
                    '<span style="color:#ea4335;">æª”æ¡ˆè®€å–å¤±æ•—: ' + error.message + '</span>';
            }
        };
        
        reader.readAsArrayBuffer(file);
    });
}

// è™•ç†00æª”æ¡ˆï¼ˆåŒ…å«å¤šå€‹å·¥ä½œè¡¨ï¼‰
function process00File(workbook) {
    // è™•ç†00å·¥ä½œè¡¨ - æ›ç‰Œé«˜ä½è³‡æ–™
    if (workbook.SheetNames.includes('00')) {
        const sheet = workbook.Sheets['00'];
        const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        
        // å¾ç¬¬2è¡Œé–‹å§‹ï¼ˆè·³éæ¨™é¡Œï¼‰
        for (let i = 1; i < data.length; i++) {
            const row = data[i];
            if (row[0]) { // CBä»£è™Ÿ
                highLowData[String(row[0])] = {
                    name: row[1] || '',         // CBåç¨±
                    high: parseFloat(row[2]) || 0,    // æ›ç‰Œæœ€é«˜
                    low: parseFloat(row[3]) || 0,     // æ›ç‰Œæœ€ä½
                    avgBid: parseFloat(row[4]) || 0,  // å¹³å‡å¾—æ¨™
                    method: row[5] || '',             // ç™¼è¡Œæ–¹å¼
                    security: row[6] || ''            // æ“”ä¿æƒ…å½¢
                };
            }
        }
        console.log('è¼‰å…¥æ›ç‰Œé«˜ä½è³‡æ–™:', Object.keys(highLowData).length, 'ç­†');
    }
    
    // è™•ç†01å·¥ä½œè¡¨ - CBåŸºæœ¬è³‡æ–™
    if (workbook.SheetNames.includes('01')) {
        const sheet = workbook.Sheets['01'];
        const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        
        for (let i = 1; i < data.length; i++) {
            const row = data[i];
            if (row[0]) {
                cbDatabase[String(row[0])] = {
                    cb_code: row[0],
                    stock_code: row[1],
                    name: row[2],
                    issue_amount: row[3],
                    conversion_price: row[4],
                    issue_years: row[5],
                    method: row[6],
                    underwriter: row[7],
                    industry: row[8],
                    stock_capital: row[9]
                };
            }
        }
        console.log('è¼‰å…¥CBåŸºæœ¬è³‡æ–™:', Object.keys(cbDatabase).length, 'ç­†');
    }
    
    // è™•ç†04å·¥ä½œè¡¨ - ç«¶æ‹è³‡æ–™
    if (workbook.SheetNames.includes('04')) {
        const sheet = workbook.Sheets['04'];
        const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        
        for (let i = 1; i < data.length; i++) {
            const row = data[i];
            if (row[0]) {
                auctionData[String(row[0])] = {
                    cb_code: row[0],
                    name: row[1],
                    theoretical_price: parseFloat(row[2]) || 0,
                    min_bid: parseFloat(row[3]) || 0,
                    avg_bid: parseFloat(row[4]) || 0,
                    bid_multiple: parseFloat(row[5]) || 0,
                    valid_bids: parseInt(row[6]) || 0,
                    total_bids: parseInt(row[7]) || 0,
                    security: row[8] || ''
                };
            }
        }
        console.log('è¼‰å…¥ç«¶æ‹è³‡æ–™:', Object.keys(auctionData).length, 'ç­†');
    }
    
    filesLoaded.cb = true;
}

// è™•ç†CBASæª”æ¡ˆ
function processCBASFile(workbook) {
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
    
    for (let i = 1; i < data.length; i++) {
        const row = data[i];
        if (row[0]) {
            cbasData[String(row[0])] = {
                cb_code: row[0],
                name: row[1],
                latest_price: parseFloat(row[2]) || 0,
                change: parseFloat(row[3]) || 0,
                volume: parseInt(row[4]) || 0
            };
        }
    }
    console.log('è¼‰å…¥CBASè³‡æ–™:', Object.keys(cbasData).length, 'ç­†');
    filesLoaded.cbas = true;
}

// è™•ç†åƒ¹æ ¼æª”æ¡ˆ
function processPriceFile(workbook) {
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
    
    // åƒ¹æ ¼è³‡æ–™æ ¼å¼å¯èƒ½éœ€è¦æ ¹æ“šå¯¦éš›æª”æ¡ˆèª¿æ•´
    console.log('è¼‰å…¥åƒ¹æ ¼è³‡æ–™');
    filesLoaded.price = true;
}

// è¼”åŠ©å‡½æ•¸ï¼šæœå°‹CB
function searchCB(input) {
    // å¾è³‡æ–™åº«ä¸­æœå°‹CB
    const paddedInput = input.padStart(5, '0');
    if (cbDatabase[paddedInput]) {
        return cbDatabase[paddedInput];
    }
    
    // æœå°‹åç¨±
    for (let code in cbDatabase) {
        if (cbDatabase[code].name && cbDatabase[code].name.includes(input)) {
            return cbDatabase[code];
        }
    }
    
    return null;
}

// ===== ä¿®æ­£æª”æ¡ˆè™•ç†å‡½æ•¸ =====
window.handleFiles = function(event) {
    const files = event.target.files;
    if (!files || files.length === 0) return;
    
    const status = document.getElementById('fileStatus');
    status.textContent = 'è®€å–æª”æ¡ˆä¸­...';
    status.style.color = '#1a73e8';
    
    let processedFiles = 0;
    const totalFiles = files.length;
    
    Array.from(files).forEach(file => {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const fileName = file.name.toLowerCase();
                
                console.log('è™•ç†æª”æ¡ˆ:', fileName, 'å·¥ä½œè¡¨:', workbook.SheetNames);
                
                // è™•ç†00æª”æ¡ˆ (åŒ…å«å¤šå€‹å·¥ä½œè¡¨)
                if (fileName.includes('00') || fileName.includes('åŸºæœ¬')) {
                    // è®€å–00å·¥ä½œè¡¨ - æ›ç‰Œé«˜ä½
                    if (workbook.SheetNames.includes('00')) {
                        const sheet = workbook.Sheets['00'];
                        const jsonData = XLSX.utils.sheet_to_json(sheet);
                        
                        jsonData.forEach(row => {
                            const cbCode = String(row['CBä»£è™Ÿ'] || row['ä»£è™Ÿ'] || '').trim();
                            if (cbCode) {
                                highLowData[cbCode] = {
                                    name: row['CBåç¨±'] || row['åç¨±'] || '',
                                    high: parseFloat(row['æ›ç‰Œæœ€é«˜'] || row['æœ€é«˜'] || 0),
                                    low: parseFloat(row['æ›ç‰Œæœ€ä½'] || row['æœ€ä½'] || 0),
                                    avgBid: parseFloat(row['å¹³å‡å¾—æ¨™'] || row['å¾—æ¨™åƒ¹'] || 100),
                                    method: row['ç™¼è¡Œæ–¹å¼'] || row['æ–¹å¼'] || '',
                                    security: row['æ“”ä¿'] || row['æ“”ä¿æƒ…å½¢'] || ''
                                };
                            }
                        });
                        
                        console.log('è¼‰å…¥æ›ç‰Œé«˜ä½è³‡æ–™:', Object.keys(highLowData).length);
                    }
                    
                    // è®€å–01å·¥ä½œè¡¨ - åŸºæœ¬è³‡æ–™
                    if (workbook.SheetNames.includes('01')) {
                        const sheet = workbook.Sheets['01'];
                        const jsonData = XLSX.utils.sheet_to_json(sheet);
                        
                        jsonData.forEach(row => {
                            const cbCode = String(row['CBä»£è™Ÿ'] || row['ä»£è™Ÿ'] || '').trim();
                            if (cbCode) {
                                cbDatabase[cbCode] = row;
                            }
                        });
                        console.log('è¼‰å…¥åŸºæœ¬è³‡æ–™:', Object.keys(cbDatabase).length);
                    }
                }
                
                processedFiles++;
                if (processedFiles === totalFiles) {
                    status.textContent = 'âœ… æª”æ¡ˆè¼‰å…¥æˆåŠŸ';
                    status.style.color = '#34a853';
                    
                    // æ›´æ–°è³‡æ–™çµ±è¨ˆ
                    const totalCBs = Object.keys(highLowData).length;
                    document.getElementById('dataBadge').textContent = `è³‡æ–™åº«å°±ç·’ (å…± ${totalCBs} æª”)`;
                    
                    // æ›´æ–°æ’è¡Œæ¦œ
                    updateAmplitudeRanking();
                }
                
            } catch (error) {
                status.textContent = 'æª”æ¡ˆè®€å–å¤±æ•—: ' + error.message;
                status.style.color = '#ea4335';
                console.error('éŒ¯èª¤:', error);
            }
        };
        
        reader.readAsArrayBuffer(file);
    });
}

// è™•ç†æª”æ¡ˆä¸Šå‚³
function handleFiles(event) {
    const files = event.target.files;
    if (!files || files.length === 0) return;
    
    document.getElementById('fileStatus').innerHTML = '<span class="status-loading">è®€å–æª”æ¡ˆä¸­...</span>';
    
    Array.from(files).forEach(file => {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                
                // æ ¹æ“šæª”æ¡ˆåç¨±åˆ¤æ–·é¡å‹
                const fileName = file.name.toLowerCase();
                if (fileName.includes('cbä»£è™Ÿ') || fileName.includes('00_cb')) {
                    processCBFile(workbook);
                    filesLoaded.cb = true;
                } else if (fileName.includes('cbas') || fileName.includes('æ‹†è§£')) {
                    processCBASFile(workbook);
                    filesLoaded.cbas = true;
                } else if (fileName.includes('æˆäº¤åƒ¹') || fileName.includes('04_cb')) {
                    processPriceFile(workbook);
                    filesLoaded.price = true;
                }
                
                checkFilesStatus();
                
            } catch (error) {
                console.error('æª”æ¡ˆè™•ç†éŒ¯èª¤:', error);
                document.getElementById('fileStatus').innerHTML = 
                    '<span class="status-error">æª”æ¡ˆè®€å–å¤±æ•—: ' + error.message + '</span>';
            }
        };
        
        reader.readAsArrayBuffer(file);
    });
}

// è™•ç†CBåŸºæœ¬è³‡æ–™æª”æ¡ˆ
function processCBFile(workbook) {
    const sheetName = workbook.SheetNames[0];
    const worksheet = workbook.Sheets[sheetName];
    const jsonData = XLSX.utils.sheet_to_json(worksheet);
    
    cbDatabase = {};
    jsonData.forEach(row => {
        if (row['ä»£è™Ÿ']) {
            const cbCode = String(row['ä»£è™Ÿ']).padStart(5, '0');
            cbDatabase[cbCode] = {
                cb_code: cbCode,
                stock_code: String(row['è‚¡ç¥¨ä»£è™Ÿ'] || ''),
                name: row['åç¨±'] || '',
                conversion_price: parseFloat(row['è½‰æ›åƒ¹æ ¼']) || 0
            };
        }
    });
    
    console.log(`è¼‰å…¥CBè³‡æ–™: ${Object.keys(cbDatabase).length}ç­†`);
}

// è™•ç†CBASæª”æ¡ˆ
function processCBASFile(workbook) {
    cbasData = {};
    
    // è·³éç¬¬ä¸€å€‹ç¸½è¡¨
    for (let i = 1; i < workbook.SheetNames.length && i < 20; i++) {
        const sheetName = workbook.SheetNames[i];
        const worksheet = workbook.Sheets[sheetName];
        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, range: 3 });
        
        const monthData = {};
        jsonData.forEach(row => {
            if (row[0] && !isNaN(row[0])) {
                const cbCode = String(row[0]).padStart(5, '0');
                monthData[cbCode] = {
                    premium_avg: parseFloat(row[6]) || 0
                };
            }
        });
        
        cbasData[sheetName] = monthData;
    }
    
    console.log(`è¼‰å…¥CBASè³‡æ–™: ${Object.keys(cbasData).length}å€‹æœˆ`);
}

// è™•ç†åƒ¹æ ¼æª”æ¡ˆ
function processPriceFile(workbook) {
    priceData = {};
    
    // è·³éç¬¬ä¸€å€‹ç¸½è¡¨
    for (let i = 1; i < workbook.SheetNames.length && i < 20; i++) {
        const sheetName = workbook.SheetNames[i];
        const worksheet = workbook.Sheets[sheetName];
        const jsonData = XLSX.utils.sheet_to_json(worksheet);
        
        const monthData = {};
        jsonData.forEach(row => {
            if (row['ä»£è™Ÿ']) {
                const cbCode = String(row['ä»£è™Ÿ']).padStart(5, '0');
                monthData[cbCode] = {
                    avg_price: parseFloat(row['å¹³å‡']) || 0,
                    volume: parseInt(row['æˆäº¤é‡']) || 0
                };
            }
        });
        
        priceData[sheetName] = monthData;
    }
    
    console.log(`è¼‰å…¥åƒ¹æ ¼è³‡æ–™: ${Object.keys(priceData).length}å€‹æœˆ`);
}

// æª¢æŸ¥æª”æ¡ˆè¼‰å…¥ç‹€æ…‹
function checkFilesStatus() {
    const loaded = Object.values(filesLoaded).filter(v => v).length;
    
    if (loaded === 3) {
        document.getElementById('fileStatus').innerHTML = 
            '<span class="status-ok">âœ… æ‰€æœ‰æª”æ¡ˆè¼‰å…¥æˆåŠŸ</span>';
        document.getElementById('dataBadge').textContent = 
            `è³‡æ–™åº«å°±ç·’ (å…± ${Object.keys(cbDatabase).length} æª”)`;
        updateCBList();
        loadCBData(currentCB);
    } else {
        document.getElementById('fileStatus').innerHTML = 
            `<span class="status-loading">å·²è¼‰å…¥ ${loaded}/3 å€‹æª”æ¡ˆ</span>`;
    }
}

// æ›´æ–°CBåˆ—è¡¨
function updateCBList() {
    const listContent = document.getElementById('cbListContent');
    let html = '';
    let count = 0;
    
    for (let code in cbDatabase) {
        if (count >= 20) break;
        
        const cb = cbDatabase[code];
        const latestMonth = Object.keys(priceData).pop();
        const priceInfo = priceData[latestMonth]?.[code];
        const price = priceInfo ? priceInfo.avg_price.toFixed(2) : '--';
        
        html += `
            <div class="list-item" onclick="selectCB('${code}')">
                <div class="list-item-left">
                    <div class="list-item-name">${cb.name}</div>
                    <div class="list-item-code">${code}</div>
                </div>
                <div class="list-item-right">
                    <div class="list-item-price">${price}</div>
                    <div class="list-item-change ${Math.random() > 0.5 ? 'up' : 'down'}">
                        ${Math.random() > 0.5 ? '+' : '-'}${(Math.random() * 3).toFixed(2)}%
                    </div>
                </div>
            </div>
        `;
        count++;
    }
    
    listContent.innerHTML = html;
}

// æœå°‹åŠŸèƒ½
function performSearch() {
    const input = document.getElementById('searchInput').value.trim();
    if (!input) {
        alert('è«‹è¼¸å…¥CBä»£è™Ÿæˆ–åç¨±');
        return;
    }
    
    // å¦‚æœæ²’æœ‰è¼‰å…¥è³‡æ–™ï¼Œä½¿ç”¨æ¸¬è©¦è³‡æ–™
    if (Object.keys(cbDatabase).length === 0) {
        loadChart();
        return;
    }
    
    // æœå°‹CB
    const paddedInput = input.padStart(5, '0');
    if (cbDatabase[paddedInput]) {
        selectCB(paddedInput);
    } else {
        // æœå°‹åç¨±
        for (let code in cbDatabase) {
            if (cbDatabase[code].name.includes(input)) {
                selectCB(code);
                return;
            }
        }
        alert('æŸ¥ç„¡è³‡æ–™');
    }
}

// é¸æ“‡CB
function selectCB(cbCode) {
    currentCB = cbCode;
    document.getElementById('searchInput').value = cbCode;
    loadCBData(cbCode);
}

// è¼‰å…¥CBè³‡æ–™
function loadCBData(cbCode) {
    const cb = cbDatabase[cbCode];
    if (!cb) {
        // ä½¿ç”¨æ¸¬è©¦è³‡æ–™
        document.getElementById('cbName').textContent = 'å°å…‰é›»å…­';
        document.getElementById('cbCode').textContent = '23836';
        document.getElementById('cbPrice').textContent = '203.77';
        document.getElementById('closePrice').textContent = '203.77';
        loadChart();
        return;
    }
    
    // æ›´æ–°åŸºæœ¬è³‡è¨Š
    document.getElementById('cbName').textContent = cb.name;
    document.getElementById('cbCode').textContent = cbCode;
    
    // å–å¾—æœ€æ–°åƒ¹æ ¼
    const latestMonth = Object.keys(priceData).pop();
    const priceInfo = priceData[latestMonth]?.[cbCode];
    const price = priceInfo ? priceInfo.avg_price.toFixed(2) : '--';
    
    document.getElementById('cbPrice').textContent = price;
    document.getElementById('closePrice').textContent = price;
    
    // æ›´æ–°å…¶ä»–è³‡è¨Š
    document.getElementById('conversionPrice').textContent = 
        cb.conversion_price ? cb.conversion_price.toFixed(2) : '-';
    
    loadChart();
}

// è¼‰å…¥åœ–è¡¨
function loadChart() {
    if (!priceChart) {
        priceChart = echarts.init(document.getElementById('priceChart'));
    }
    
    // æ”¶é›†åƒ¹æ ¼è³‡æ–™
    const chartData = [];
    const months = Object.keys(priceData).slice(-12); // æœ€è¿‘12å€‹æœˆ
    
    months.forEach(month => {
        const monthData = priceData[month]?.[currentCB];
        if (monthData && monthData.avg_price > 0) {
            chartData.push({
                date: formatMonth(month),
                price: monthData.avg_price
            });
        }
    });
    
    // å¦‚æœæ²’æœ‰è³‡æ–™ï¼Œä½¿ç”¨æ¸¬è©¦è³‡æ–™
    if (chartData.length === 0) {
        for (let i = 11; i >= 0; i--) {
            const date = new Date();
            date.setMonth(date.getMonth() - i);
            chartData.push({
                date: (date.getMonth() + 1) + 'æœˆ',
                price: 200 + Math.random() * 10
            });
        }
    }
    
    const option = {
        grid: {
            left: 50,
            right: 20,
            top: 20,
            bottom: 40
        },
        xAxis: {
            type: 'category',
            data: chartData.map(d => d.date),
            axisLabel: {
                fontSize: 10
            }
        },
        yAxis: {
            type: 'value',
            axisLabel: {
                fontSize: 10
            }
        },
        series: [{
            data: chartData.map(d => d.price.toFixed(2)),
            type: 'line',
            smooth: true,
            lineStyle: {
                width: 2,
                color: '#ea4335'
            },
            areaStyle: {
                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    { offset: 0, color: 'rgba(234,67,53,0.2)' },
                    { offset: 1, color: 'rgba(234,67,53,0)' }
                ])
            },
            symbol: 'none'
        }]
    };
    
    priceChart.setOption(option);
}

// æ ¼å¼åŒ–æœˆä»½
function formatMonth(monthStr) {
    if (monthStr.length >= 4) {
        return monthStr.substring(2, 4) + 'æœˆ';
    }
    return monthStr;
}

// æ”¹è®Šæ™‚é–“ç¯„åœ
function changeTimeRange(months) {
    document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    // é‡æ–°è¼‰å…¥åœ–è¡¨ï¼ˆé€™è£¡å¯ä»¥æ ¹æ“šmonthsåƒæ•¸èª¿æ•´é¡¯ç¤ºç¯„åœï¼‰
    loadChart();
}

// ====== ç ”ç©¶å ±å‘Šå°ˆå€å‡½æ•¸ ======
// å…¨åŸŸè®Šæ•¸ - ç ”ç©¶å ±å‘Šè³‡æ–™
let industryData = {};      // ç”¢æ¥­åˆ†é¡è³‡æ–™
let conceptData = {};       // æ¦‚å¿µè‚¡è³‡æ–™
let foreignNewsData = [];   // å¤–é›»å ±å°è³‡æ–™
let stockReportsData = [];  // å€‹è‚¡ç ”ç©¶å ±å‘Šè³‡æ–™

// è™•ç†cb168reportæª”æ¡ˆ
function handleReportFile(file) {
    const reader = new FileReader();
    
    reader.onload = function(e) {
        try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            
            console.log('ç ”ç©¶å ±å‘Šå·¥ä½œè¡¨:', workbook.SheetNames);
            
            // è®€å–ç”¢æ¥­åˆ†é¡è³‡æ–™
            if (workbook.SheetNames.includes('ç”¢æ¥­åˆ†é¡')) {
                const sheet = workbook.Sheets['ç”¢æ¥­åˆ†é¡'];
                const jsonData = XLSX.utils.sheet_to_json(sheet);
                
                jsonData.forEach(row => {
                    const code = String(row['ä»£è™Ÿ'] || '').trim();
                    if (code) {
                        industryData[code] = {
                            name: row['åç¨±'] || '',
                            market: row['å¸‚å ´'] || '',
                            industry: row['ç”¢æ¥­'] || '',
                            subIndustry: row['ç´°ç”¢æ¥­'] || '',
                            position: row['ç”¢æ¥­åœ°ä½'] || ''
                        };
                    }
                });
                console.log('è¼‰å…¥ç”¢æ¥­åˆ†é¡:', Object.keys(industryData).length);
            }
            
            // è®€å–æ¦‚å¿µè‚¡è³‡æ–™
            if (workbook.SheetNames.includes('æ¦‚å¿µè‚¡æ—ç¾¤è³‡æ–™åº«')) {
                const sheet = workbook.Sheets['æ¦‚å¿µè‚¡æ—ç¾¤è³‡æ–™åº«'];
                const jsonData = XLSX.utils.sheet_to_json(sheet);
                
                conceptData = {};
                jsonData.forEach(row => {
                    const code = String(row['è‚¡ç¥¨ä»£è™Ÿ'] || '').trim();
                    if (code) {
                        if (!conceptData[code]) {
                            conceptData[code] = [];
                        }
                        conceptData[code].push({
                            name: row['å…¬å¸åç¨±'] || '',
                            concept: row['æ¦‚å¿µåˆ†é¡'] || '',
                            subCategory: row['æ¬¡åˆ†é¡/æ¥­å‹™è§’è‰²'] || '',
                            description: row['é¡Œæèªªæ˜'] || ''
                        });
                    }
                });
                console.log('è¼‰å…¥æ¦‚å¿µè‚¡:', Object.keys(conceptData).length);
            }
            
            // è®€å–å¤–é›»å ±å°
            if (workbook.SheetNames.includes('å¤–é›»ç¶œåˆå ±å°')) {
                const sheet = workbook.Sheets['å¤–é›»ç¶œåˆå ±å°'];
                foreignNewsData = XLSX.utils.sheet_to_json(sheet);
                console.log('è¼‰å…¥å¤–é›»å ±å°:', foreignNewsData.length);
            }
            
            // è®€å–å€‹è‚¡ç ”ç©¶å ±å‘Š
            if (workbook.SheetNames.includes('è©³ç´°å…§å®¹åº«')) {
                const sheet = workbook.Sheets['è©³ç´°å…§å®¹åº«'];
                stockReportsData = XLSX.utils.sheet_to_json(sheet);
                console.log('è¼‰å…¥å€‹è‚¡å ±å‘Š:', stockReportsData.length);
            }
            
            // æ›´æ–°ç‹€æ…‹
            const status = document.getElementById('fileStatus');
            if (status) {
                status.innerHTML += '<br><span style="color:#34a853;">âœ… ç ”ç©¶å ±å‘Šè¼‰å…¥æˆåŠŸ</span>';
            }
            
        } catch (error) {
            console.error('ç ”ç©¶å ±å‘Šè™•ç†éŒ¯èª¤:', error);
        }
    };
    
    reader.readAsArrayBuffer(file);
}

// ä¿®æ”¹åŸæœ¬çš„handleFileså‡½æ•¸ï¼ŒåŠ å…¥cb168reportæª”æ¡ˆè™•ç†
const originalHandleFiles = window.handleFiles;
window.handleFiles = function(event) {
    const files = event.target.files;
    if (!files) return;
    
    // è™•ç†åŸæœ¬çš„CBæª”æ¡ˆ
    originalHandleFiles(event);
    
    // æª¢æŸ¥æ˜¯å¦æœ‰cb168reportæª”æ¡ˆ
    Array.from(files).forEach(file => {
        if (file.name.toLowerCase().includes('cb168report')) {
            handleReportFile(file);
        }
    });
}

// ç”¢æ¥­æ¦‚å¿µè‚¡æŸ¥è©¢
function initIndustryConcept() {
    console.log('åˆå§‹åŒ–ç”¢æ¥­æ¦‚å¿µè‚¡æŸ¥è©¢');
}

function searchIndustryConcept() {
    const input = document.getElementById('industrySearchInput').value.trim();
    if (!input) {
        alert('è«‹è¼¸å…¥æŸ¥è©¢æ¢ä»¶');
        return;
    }
    
    // æœå°‹ç”¢æ¥­è³‡æ–™
    let found = industryData[input];
    
    if (!found) {
        // ç”¨åç¨±æœå°‹
        for (let code in industryData) {
            if (industryData[code].name.includes(input)) {
                found = { ...industryData[code], code: code };
                break;
            }
        }
    } else {
        found = { ...found, code: input };
    }
    
    if (found) {
        displayIndustryResult(found);
    } else {
        alert('æŸ¥ç„¡è³‡æ–™');
    }
}

function displayIndustryResult(data) {
    document.getElementById('icCompanyName').textContent = data.name;
    document.getElementById('icStockCode').textContent = data.code;
    document.getElementById('icMarket').textContent = data.market;
    document.getElementById('icIndustry').textContent = data.industry;
    document.getElementById('icSubIndustry').textContent = data.subIndustry;
    document.getElementById('icPosition').textContent = data.position;
    
    // é¡¯ç¤ºç›¸é—œæ¦‚å¿µè‚¡
    const concepts = conceptData[data.code] || [];
    let html = '';
    concepts.forEach(concept => {
        html += `
            <div class="concept-item">
                <div class="concept-title">${concept.concept}</div>
                <div class="concept-subtitle">${concept.subCategory}</div>
                <div class="concept-desc">${concept.description}</div>
            </div>
        `;
    });
    
    document.getElementById('conceptItems').innerHTML = html || '<p>ç„¡ç›¸é—œæ¦‚å¿µè‚¡è³‡æ–™</p>';
    document.getElementById('industryConceptResult').style.display = 'block';
}

function searchByIndustry(industry) {
    document.getElementById('industrySearchInput').value = industry;
    // å¯¦ä½œç”¢æ¥­ç¯©é¸é‚è¼¯
}

// å¤–é›»å ±å°
function initForeignNews() {
    loadForeignNews();
}

function loadForeignNews() {
    if (foreignNewsData.length === 0) {
        document.getElementById('foreignNewsList').innerHTML = 
            '<div style="text-align:center;padding:40px;color:#999;">è«‹å…ˆè¼‰å…¥cb168report.xlsxæª”æ¡ˆ</div>';
        return;
    }
    
    displayForeignNews(foreignNewsData.slice(0, 20)); // é¡¯ç¤ºå‰20ç­†
}

function displayForeignNews(newsData) {
    let html = '';
    newsData.forEach(news => {
        const importance = news['é‡è¦æ€§'] === 'é«˜' ? 'news-badge' : '';
        html += `
            <div class="news-item">
                <div class="news-date">${news['æ—¥æœŸ'] || ''}</div>
                <div class="news-title">
                    <span>${news['å…¬å¸'] || ''} (${news['è‚¡è™Ÿ'] || ''})</span>
                    ${importance ? '<span class="news-badge">é‡è¦</span>' : ''}
                </div>
                <div class="news-content">${news['å®Œæ•´å ±å°å…§å®¹'] || ''}</div>
                <div class="news-meta">
                    <span>ä¾†æº: ${news['åˆ¸å•†ä¾†æº'] || ''}</span>
                    <span>åˆ†é¡: ${news['å ±å°é‡é»åˆ†é¡'] || ''}</span>
                </div>
            </div>
        `;
    });
    
    document.getElementById('foreignNewsList').innerHTML = html;
}

function filterForeignNews() {
    // å¯¦ä½œç¯©é¸é‚è¼¯
}

function searchForeignNews() {
    const keyword = document.getElementById('newsSearchInput').value.trim();
    if (!keyword) {
        loadForeignNews();
        return;
    }
    
    const filtered = foreignNewsData.filter(news => 
        (news['å…¬å¸'] && news['å…¬å¸'].includes(keyword)) ||
        (news['å®Œæ•´å ±å°å…§å®¹'] && news['å®Œæ•´å ±å°å…§å®¹'].includes(keyword))
    );
    
    displayForeignNews(filtered);
}

// å€‹è‚¡ç ”ç©¶å ±å‘Š
function initStockReports() {
    loadStockReports();
}

function loadStockReports() {
    if (stockReportsData.length === 0) {
        document.getElementById('stockReportsList').innerHTML = 
            '<div style="text-align:center;padding:40px;color:#999;">è«‹å…ˆè¼‰å…¥cb168report.xlsxæª”æ¡ˆ</div>';
        return;
    }
    
    displayStockReports(stockReportsData.slice(0, 10)); // é¡¯ç¤ºå‰10ç­†
}

function displayStockReports(reports) {
    let html = '';
    reports.forEach(report => {
        const rating = report['æŠ•è³‡è©•ç­‰'] || '';
        const ratingClass = rating.includes('è²·') ? 'rating-buy' : 
                           rating.includes('ä¸­ç«‹') ? 'rating-neutral' : 'rating-sell';
        
        html += `
            <div class="report-item">
                <div class="report-header">
                    <div class="report-title">${report['å…¬å¸'] || ''} (${report['è‚¡è™Ÿ'] || ''})</div>
                    <div class="report-rating ${ratingClass}">${rating}</div>
                </div>
                <div class="report-meta">
                    <span>åˆ¸å•†: ${report['åˆ¸å•†'] || ''}</span>
                    <span>æ—¥æœŸ: ${report['å ±å‘Šæ—¥æœŸ'] || ''}</span>
                    <span>ç›®æ¨™åƒ¹: ${report['ç›®æ¨™åƒ¹'] || '--'}</span>
                </div>
                <div class="report-summary">${report['ç²¾ç°¡é‡é»æ‘˜è¦'] || ''}</div>
            </div>
        `;
    });
    
    document.getElementById('stockReportsList').innerHTML = html;
}

function searchStockReport() {
    const input = document.getElementById('stockReportSearchInput').value.trim();
    if (!input) {
        loadStockReports();
        return;
    }
    
    const filtered = stockReportsData.filter(report => 
        (report['å…¬å¸'] && report['å…¬å¸'].includes(input)) ||
        (report['è‚¡è™Ÿ'] && report['è‚¡è™Ÿ'].includes(input))
    );
    
    displayStockReports(filtered);
}

function filterStockReports() {
    // å¯¦ä½œç¯©é¸é‚è¼¯
}

// ç”¢æ¥­ç ”ç©¶å ±å‘Š
function initIndustryReports() {
    console.log('ç”¢æ¥­ç ”ç©¶å ±å‘ŠåŠŸèƒ½é–‹ç™¼ä¸­');
}

// åˆå§‹åŒ–
window.addEventListener('DOMContentLoaded', function() {
    // ç¢ºä¿å…¨åŸŸè®Šæ•¸å·²åˆå§‹åŒ–
    if (typeof highLowData === 'undefined') {
        window.highLowData = {};
    }
    if (typeof cbDatabase === 'undefined') {
        window.cbDatabase = {};
    }
    if (typeof auctionData === 'undefined') {
        window.auctionData = {};
    }
    
    // éš±è—è¼‰å…¥ç•«é¢
    setTimeout(() => {
        document.getElementById('loadingScreen').style.display = 'none';
    }, 500);
    
    // è¼‰å…¥æ¸¬è©¦åœ–è¡¨
    setTimeout(() => {
        loadChart();
    }, 600);
});

// è™•ç†è¦–çª—èª¿æ•´
window.addEventListener('resize', () => {
    if (priceChart) {
        priceChart.resize();
    }
});

// Enteréµæœå°‹
document.getElementById('searchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        performSearch();
    }
});
</script>

</body>
</html>