<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rexå¤§å” æ™ºèƒ½CBæˆ°æƒ…å®¤ (Auto v10)</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #1e3c72; --secondary: #2a5298; --accent: #0ea5e9; --bg: #f8fafc; --text: #1e293b; --sidebar-w: 280px; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif; background: var(--bg); color: var(--text); padding-top: 60px; overflow-x: hidden; }
        
        /* Loader */
        .loader-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s; }
        .spinner { width: 50px; height: 50px; border: 4px solid #e2e8f0; border-top: 4px solid var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; margin-bottom: 20px; }
        .progress-bar { width: 240px; height: 6px; background: #f1f5f9; border-radius: 3px; overflow: hidden; margin-top: 10px; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s; }
        
        /* Layout */
        .header { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; position: fixed; top: 0; width: 100%; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .menu-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
        .header-title { font-size: 18px; font-weight: 700; margin-left: 10px; }
        
        .sidebar { position: fixed; left: calc(var(--sidebar-w) * -1); top: 0; width: var(--sidebar-w); height: 100vh; background: white; transition: left 0.3s ease; z-index: 2000; box-shadow: 4px 0 15px rgba(0,0,0,0.1); overflow-y: auto; }
        .sidebar.active { left: 0; }
        .sidebar-header { background: linear-gradient(135deg, var(--primary), var(--secondary)); padding: 30px 20px; color: white; }
        .menu-group { padding: 10px 0; border-bottom: 1px solid #f0f0f0; }
        .menu-item { display: flex; align-items: center; padding: 14px 20px; cursor: pointer; color: #333; text-decoration: none; font-weight: 500; transition: 0.2s; }
        .menu-item:hover { background: #f0f9ff; color: var(--accent); }
        .menu-item.active { background: #e0f2fe; color: var(--primary); border-left: 4px solid var(--primary); }
        .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; z-index: 1500; }
        .overlay.active { display: block; }

        /* Content */
        .page-content { display: none; padding: 20px; max-width: 1200px; margin: 0 auto; animation: fadeIn 0.4s; }
        .page-content.active { display: block; }
        
        /* Search */
        .search-container { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .input-group { display: flex; gap: 10px; margin-top: 15px; }
        .search-input { flex: 1; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px; outline: none; }
        .search-input:focus { border-color: var(--accent); }
        .search-btn { padding: 0 24px; background: var(--accent); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }

        /* Cards */
        .card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid transparent; cursor: pointer; transition: 0.2s; }
        .card:hover { transform: translateY(-2px); border-color: var(--accent); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .card-header { display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #f1f5f9; }
        .cb-name { font-size: 18px; font-weight: 700; }
        .data-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .data-item { background: #f8fafc; padding: 8px; border-radius: 6px; text-align: center; }
        .data-label { font-size: 12px; color: #64748b; }
        .data-value { font-size: 16px; font-weight: 600; }
        .red { color: #ef4444; } .green { color: #10b981; } .blue { color: #3b82f6; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 3000; overflow-y: auto; padding: 20px 0; backdrop-filter: blur(2px); }
        .modal.active { display: flex; justify-content: center; align-items: flex-start; }
        .modal-content { background: white; width: 95%; max-width: 900px; border-radius: 16px; padding: 25px; position: relative; margin-bottom: 50px; animation: slideUp 0.3s; }
        .chart-box { height: 320px; width: 100%; border: 1px solid #e2e8f0; border-radius: 8px; padding: 10px; margin-top: 15px; }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

    <div id="loader" class="loader-screen">
        <div class="spinner"></div>
        <h3 style="color: var(--primary);">Rexå¤§å” æˆ°æƒ…å®¤</h3>
        <div id="loadStatus" style="font-size:13px; color:#64748b; margin-top:5px;">æ­£åœ¨è‡ªå‹•é€£çµè³‡æ–™åº«...</div>
        <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
    </div>

    <header class="header">
        <div class="header-left">
            <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
            <span class="header-title">Rexå¤§å” æ™ºèƒ½CBæˆ°æƒ…å®¤</span>
        </div>
        <div id="dbBadge" style="font-size:12px; background:rgba(255,255,255,0.2); padding:4px 12px; border-radius:15px;">é€£ç·šä¸­...</div>
    </header>

    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <div style="font-size:20px; font-weight:800;">Rexå¤§å”168</div>
            <div style="font-size:12px; opacity:0.8; margin-top:5px;">å…¨è‡ªå‹•æ•¸æ“šæ•´åˆç³»çµ±</div>
        </div>
        <div class="menu-group">
            <a class="menu-item active" onclick="showPage('home')">ğŸ  æˆ°æƒ…å®¤é¦–é </a>
            <a class="menu-item" onclick="showPage('basic')">ğŸ“‹ CB åŸºæœ¬è³‡æ–™</a>
            <a class="menu-item" onclick="showPage('highlow')">ğŸ“Š æ›ç‰Œé«˜ä½</a>
            <a class="menu-item" onclick="showPage('auction')">ğŸ”¨ ç«¶æ‹æ•¸æ“š</a>
        </div>
        <div class="menu-group">
            <a class="menu-item" onclick="showPage('cbas')">ğŸ“ˆ CBAS æ‹†è§£</a>
            <a class="menu-item" onclick="showPage('report')">ğŸ“‘ ç ”ç©¶å ±å‘Š</a>
            <a class="menu-item" onclick="showPage('industry')">ğŸ­ ç”¢æ¥­æ¦‚å¿µ</a>
        </div>
    </div>
    <div id="overlay" class="overlay" onclick="closeMenu()"></div>

    <div id="page-home" class="page-content active">
        <div class="search-container">
            <h3>ğŸ” æ™ºèƒ½æœå°‹</h3>
            <div class="input-group">
                <input type="text" class="search-input" id="mainSearch" placeholder="è¼¸å…¥ä»£è™Ÿ (68732)ã€åç¨±æˆ–æ¦‚å¿µè‚¡..." onkeyup="if(event.key==='Enter') doSearch()">
                <button class="search-btn" onclick="doSearch()">GO</button>
            </div>
            <div style="margin-top:10px; font-size:12px; color:#64748b;">
                å·²æ•´åˆï¼šæ›ç‰Œé«˜ä½ã€CBASæ­·å²ã€ç«¶æ‹ã€å€‹è‚¡å ±å‘Šã€ç”¢æ¥­åœ°ä½
            </div>
        </div>
        <div id="homeResults">
            <div style="text-align:center; padding:60px; color:#cbd5e1;">
                <div style="font-size:48px; margin-bottom:15px;">ğŸš€</div>
                ç­‰å¾…æŒ‡ä»¤ä¸­...
            </div>
        </div>
    </div>

    <div id="page-basic" class="page-content"><h2>ğŸ“‹ CB åŸºæœ¬è³‡æ–™</h2><div id="basicList"></div></div>
    <div id="page-highlow" class="page-content"><h2>ğŸ“Š æ›ç‰Œé«˜ä½</h2><div id="highlowList"></div></div>
    <div id="page-auction" class="page-content"><h2>ğŸ”¨ ç«¶æ‹æ•¸æ“š</h2><div id="auctionList"></div></div>
    <div id="page-cbas" class="page-content"><h2>ğŸ“ˆ CBAS æ‹†è§£</h2><div id="cbasList"></div></div>
    <div id="page-report" class="page-content"><h2>ğŸ“‘ ç ”ç©¶å ±å‘Š</h2><div id="reportList"></div></div>
    <div id="page-industry" class="page-content"><h2>ğŸ­ ç”¢æ¥­æ¦‚å¿µ</h2><div id="industryList"></div></div>

    <div id="detailModal" class="modal" onclick="if(event.target===this) closeModal()">
        <div class="modal-content">
            <div style="position:absolute; right:20px; top:20px; font-size:24px; cursor:pointer;" onclick="closeModal()">Ã—</div>
            <div id="modalBody"></div>
        </div>
    </div>

<script>
// 1. è³‡æ–™åº«çµæ§‹
const DB = { basic:{}, highlow:{}, auction:{}, industry:{}, concepts:{}, reports:{}, news:[], cbas_latest:{}, cbas_history:{}, prices:{} };

// *** é—œéµï¼šé€™è£¡è¨­å®šäº†æ‚¨çš„æ­£ç¢ºæª”å ***
const FILES = [
    { id: '00', name: '00_CBä»£è™Ÿåç¨±.xlsx', desc: 'åŸºæœ¬è³‡æ–™' },
    { id: '01', name: '01_cb168report.xlsx', desc: 'ç ”ç©¶å ±å‘Š' },
    { id: '02', name: '02_CBASæœˆæ‹†è§£è¡¨.xlsx', desc: 'CBASæ•¸æ“š' },
    { id: '04', name: '04_CBæœˆæˆäº¤åƒ¹è¡¨.xlsx', desc: 'æ­·å²è‚¡åƒ¹' }
];

// 2. ç³»çµ±å•Ÿå‹•
window.onload = async function() {
    await loadAllFiles();
};

async function loadAllFiles() {
    const statusEl = document.getElementById('loadStatus');
    const fillEl = document.getElementById('progressFill');
    let loaded = 0;

    for (let file of FILES) {
        try {
            statusEl.innerText = `è®€å–ä¸­: ${file.desc}...`;
            const res = await fetch(file.name);
            if (!res.ok) throw new Error(`æ‰¾ä¸åˆ°æª”æ¡ˆ ${file.name}`);
            
            const ab = await res.arrayBuffer();
            const wb = XLSX.read(ab, { type: 'array' });
            parseWorkbook(file.id, wb);
            
            loaded++;
            fillEl.style.width = `${(loaded / FILES.length) * 100}%`;
        } catch (err) {
            console.error(err);
            statusEl.innerHTML += `<br><span style="color:red">âŒ è®€å–å¤±æ•—: ${file.name} (è«‹ç¢ºèª GitHub æª”åæ˜¯å¦ä¸€è‡´)</span>`;
        }
    }
    
    if (loaded > 0) {
        setTimeout(() => {
            document.getElementById('loader').style.display = 'none';
            updateDbStatus();
            renderList('highlow');
        }, 800);
    }
}

function parseWorkbook(id, wb) {
    const sheetNames = wb.SheetNames;

    if (id === '00') {
        // 00_CBä»£è™Ÿåç¨±
        processSheet(wb, ['åŸºæœ¬è³‡æ–™'], row => {
            const code = getField(row, ['CBä»£è™Ÿ','ä»£è™Ÿ']);
            if(code) DB.basic[code] = row;
        });
        processSheet(wb, ['æ›ç‰Œé«˜ä½'], row => {
            const code = getField(row, ['CBä»£è™Ÿ','ä»£è™Ÿ']);
            if(code) DB.highlow[code] = row;
        });
        processSheet(wb, ['ç«¶æ‹'], row => {
            const code = getField(row, ['CBä»£è™Ÿ']);
            if(code) DB.auction[code] = row;
        });
        processSheet(wb, ['ç”¢æ¥­åˆ†é¡'], row => {
            const stock = getField(row, ['è‚¡ç¥¨ä»£è™Ÿ','ä»£è™Ÿ']);
            if(stock) DB.industry[stock] = row;
        });
    }
    else if (id === '01') {
        // 01_cb168report
        processSheet(wb, ['æ¦‚å¿µè‚¡'], row => {
            const stock = getField(row, ['è‚¡ç¥¨ä»£è™Ÿ']);
            if(stock) { if(!DB.concepts[stock]) DB.concepts[stock]=[]; DB.concepts[stock].push(row); }
        });
        processSheet(wb, ['è©³ç´°å…§å®¹'], row => {
            const stock = getField(row, ['è‚¡è™Ÿ','è‚¡ç¥¨ä»£è™Ÿ']);
            if(stock) { if(!DB.reports[stock]) DB.reports[stock]=[]; DB.reports[stock].push(row); }
        });
        processSheet(wb, ['å¤–é›»'], row => { if(row['å…¬å¸']) DB.news.push(row); });
    }
    else if (id === '02') {
        // 02_CBASæœˆæ‹†è§£è¡¨ (æ—¥æœŸå·¥ä½œè¡¨)
        sheetNames.forEach(name => {
            if(name.match(/^\d+/)) { // 10004, 11409
                const data = XLSX.utils.sheet_to_json(wb.Sheets[name]);
                const dateStr = parseTwDate(name);
                data.forEach(row => {
                    const code = getField(row, ['CBä»£è™Ÿ','å¯è½‰å‚µä»£è™Ÿ']);
                    if(code) {
                        if(!DB.cbas_history[code]) DB.cbas_history[code] = [];
                        const principal = parseFloat(getField(row,['åç›®æœ¬é‡‘']))||0;
                        const vol = Math.round(principal/100000);
                        const minP = parseFloat(getField(row,['æœ€ä½æ¬Šåˆ©é‡‘(å…ƒ)','æ¬Šåˆ©é‡‘']))||0;
                        
                        DB.cbas_history[code].push({ date: dateStr, vol, minPrice: minP });
                        
                        const curr = DB.cbas_latest[code];
                        if(!curr || dateStr > curr.date) DB.cbas_latest[code] = { ...row, date: dateStr, vol, minPrice: minP };
                    }
                });
            }
        });
        // æ’åº
        for(let c in DB.cbas_history) DB.cbas_history[c].sort((a,b)=>a.date.localeCompare(b.date));
    }
    else if (id === '04') {
        // 04_CBæœˆæˆäº¤åƒ¹è¡¨
        sheetNames.forEach(name => {
            if(name.match(/^\d+/)) {
                const data = XLSX.utils.sheet_to_json(wb.Sheets[name]);
                const dateStr = parseTwDate(name);
                data.forEach(row => {
                    const code = getField(row, ['ä»£è™Ÿ','CBä»£è™Ÿ']);
                    if(code) {
                        if(!DB.prices[code]) DB.prices[code] = [];
                        DB.prices[code].push({
                            date: dateStr,
                            price: parseFloat(getField(row, ['å¹³å‡','å¹³å‡åƒ¹']))||0,
                            high: parseFloat(getField(row, ['æœ€é«˜','æœ€é«˜åƒ¹']))||0,
                            low: parseFloat(getField(row, ['æœ€ä½','æœ€ä½åƒ¹']))||0
                        });
                    }
                });
            }
        });
        for(let c in DB.prices) DB.prices[c].sort((a,b)=>a.date.localeCompare(b.date));
    }
}

function parseTwDate(name) {
    const year = parseInt(name.slice(0, -2)) + 1911;
    const month = name.slice(-2);
    return `${year}-${month}`;
}
function processSheet(wb, keys, cb) {
    const name = wb.SheetNames.find(n => keys.some(k => n.includes(k)));
    if(name) XLSX.utils.sheet_to_json(wb.Sheets[name]).forEach(cb);
}
function getField(row, keys) {
    for(let k of keys) if(row[k]!==undefined) return String(row[k]).trim();
    return null;
}
function updateDbStatus() {
    document.getElementById('dbBadge').innerText = `DB: ${Object.keys(DB.basic).length} æª” (Ready)`;
}

// UI Logic
function toggleMenu() { document.getElementById('sidebar').classList.toggle('active'); document.getElementById('overlay').classList.toggle('active'); }
function closeMenu() { document.getElementById('sidebar').classList.remove('active'); document.getElementById('overlay').classList.remove('active'); }
function showPage(id) {
    closeMenu();
    document.querySelectorAll('.page-content').forEach(e => e.classList.remove('active'));
    document.getElementById(`page-${id}`).classList.add('active');
    document.querySelectorAll('.menu-item').forEach(e => e.classList.remove('active'));
    event.currentTarget.classList.add('active');
    if(id !== 'home') renderList(id);
}

function doSearch() {
    const val = document.getElementById('mainSearch').value.trim().toUpperCase();
    if(!val) return;
    const resDiv = document.getElementById('homeResults');
    resDiv.innerHTML = '';
    
    const results = new Set();
    // 1. æœåŸºæœ¬è³‡æ–™
    for (let code in DB.basic) {
        const b = DB.basic[code];
        if (code.includes(val) || b['åç¨±'].includes(val) || (b['è‚¡ç¥¨ä»£è™Ÿ'] && b['è‚¡ç¥¨ä»£è™Ÿ'].includes(val))) results.add(code);
    }
    // 2. æœæ¦‚å¿µè‚¡
    for(let stock in DB.concepts) {
        const list = DB.concepts[stock];
        if(list.some(c => c['æ¦‚å¿µåˆ†é¡']?.includes(val) || c['é¡Œæèªªæ˜']?.includes(val))) {
            for(let c in DB.basic) if(DB.basic[c]['è‚¡ç¥¨ä»£è™Ÿ']==stock) results.add(c);
        }
    }

    if(results.size===0) { resDiv.innerHTML='<div style="text-align:center;padding:30px;color:#999">æŸ¥ç„¡è³‡æ–™</div>'; return; }
    
    results.forEach(code => {
        const b = DB.basic[code];
        const cbas = DB.cbas_latest[code] || {};
        const div = document.createElement('div');
        div.className = 'card';
        div.onclick = () => showDetail(code);
        div.innerHTML = `
            <div class="card-header">
                <div><span class="cb-name">${b['åç¨±']||code}</span> <span class="cb-code">${code}</span></div>
                <div class="data-value blue">${cbas.minPrice||'--'}</div>
            </div>
            <div class="data-grid">
                <div class="data-item"><div class="data-label">ç™¼è¡Œè¦æ¨¡</div><div>${b['ç™¼è¡Œè¦æ¨¡']||'--'}å„„</div></div>
                <div class="data-item"><div class="data-label">è½‰æ›åƒ¹æ ¼</div><div>${b['è½‰æ›åƒ¹æ ¼']||'--'}</div></div>
                <div class="data-item"><div class="data-label">æ‹†è§£å¼µæ•¸</div><div>${cbas.volume||'--'}</div></div>
                <div class="data-item"><div class="data-label">åˆ°æœŸæ—¥</div><div>${getField(b,['åˆ°æœŸæ—¥æœŸ','åˆ°æœŸæ—¥'])||'--'}</div></div>
            </div>
        `;
        resDiv.appendChild(div);
    });
}

function renderList(id) {
    const div = document.getElementById(id+'List');
    div.innerHTML = '';
    let src = DB.basic;
    if(id==='auction') src=DB.auction;
    if(id==='cbas') src=DB.cbas_latest;
    
    let count=0;
    for(let c in src) {
        if(count++ > 50) break;
        const code = getField(src[c],['CBä»£è™Ÿ','ä»£è™Ÿ']) || c;
        const realCode = DB.basic[code] ? code : Object.keys(DB.basic).find(k=>k.includes(code));
        if(realCode && DB.basic[realCode]) {
            const b = DB.basic[realCode];
            const el = document.createElement('div');
            el.className = 'card';
            el.onclick = () => showDetail(realCode);
            el.innerHTML = `<div class="card-header"><b>${b['åç¨±']}</b> <span style="color:#999;font-size:12px">${realCode}</span></div>`;
            div.appendChild(el);
        }
    }
}

function showDetail(code) {
    const b = DB.basic[code]||{};
    const hl = DB.highlow[code]||{};
    const a = DB.auction[code]||{};
    const cbas = DB.cbas_latest[code]||{};
    const pHist = DB.prices[code]||[];
    const cHist = DB.cbas_history[code]||[];
    const stock = getField(b,['è‚¡ç¥¨ä»£è™Ÿ','è‚¡è™Ÿ']);
    const ind = DB.industry[stock]||{};
    const conc = DB.concepts[stock]||[];
    const reps = DB.reports[stock]||[];

    const modalBody = document.getElementById('modalBody');
    const tagHtml = conc.map(c=>`<span class="tag tag-green">${c['æ¦‚å¿µåˆ†é¡']}</span>`).join('');

    modalBody.innerHTML = `
        <h2 style="margin-bottom:5px">${b['åç¨±']} <span style="color:#666;font-size:16px">${code}</span></h2>
        <div style="margin-bottom:15px">${tagHtml} <span class="tag tag-blue">${ind['ç´°åˆ†ç”¢æ¥­']||''}</span></div>
        
        <div class="data-grid" style="margin-bottom:20px">
            <div class="data-item"><div class="data-label">æ¬Šåˆ©é‡‘</div><div class="data-value red">${cbas.minPrice||'--'}</div></div>
            <div class="data-item"><div class="data-label">æ‹†è§£å¼µæ•¸</div><div class="data-value blue">${cbas.volume||'--'}</div></div>
            <div class="data-item"><div class="data-label">æ›ç‰Œæœ€é«˜</div><div class="red">${hl['æ›ç‰Œæœ€é«˜']||'--'}</div></div>
            <div class="data-item"><div class="data-label">å¹³å‡å¾—æ¨™</div><div>${getField(a,['å¹³å‡å¾—æ¨™'])||'--'}</div></div>
        </div>

        <div class="chart-box" id="chart"></div>

        <h3 style="font-size:16px; margin:20px 0 10px; border-left:4px solid var(--accent); padding-left:8px;">æ³•äººå ±å‘Š & è§€é»</h3>
        <div style="background:#fff; border:1px solid #eee; padding:10px; border-radius:8px; max-height:200px; overflow-y:auto;">
            ${reps.length ? reps.map(r=>`<div style="border-bottom:1px dashed #eee; padding:5px 0; font-size:13px;"><b>${r['åˆ¸å•†']}</b>: ${r['ç²¾ç°¡é‡é»æ‘˜è¦']||''}</div>`).join('') : '<div style="text-align:center;color:#999">ç„¡å ±å‘Š</div>'}
        </div>
    `;
    
    document.getElementById('detailModal').classList.add('active');
    
    setTimeout(() => {
        if(pHist.length > 0 || cHist.length > 0) {
            const chart = echarts.init(document.getElementById('chart'));
            const dates = Array.from(new Set([...pHist.map(x=>x.date), ...cHist.map(x=>x.date)])).sort();
            const pData = dates.map(d => (pHist.find(x=>x.date===d) || {}).price);
            const cData = dates.map(d => (cHist.find(x=>x.date===d) || {}).minPrice);

            chart.setOption({
                tooltip: { trigger: 'axis' },
                legend: { data:['è‚¡åƒ¹','æ¬Šåˆ©é‡‘'], bottom:0 },
                grid: { left:'10%', right:'10%', top:'10%', bottom:'15%' },
                xAxis: { type: 'category', data: dates },
                yAxis: [
                    { type: 'value', name: 'è‚¡åƒ¹', position: 'left' },
                    { type: 'value', name: 'æ¬Šåˆ©é‡‘', position: 'right', splitLine:{show:false} }
                ],
                series: [
                    { name:'è‚¡åƒ¹', type:'line', data:pData, itemStyle:{color:'#1e3c72'}, smooth:true },
                    { name:'æ¬Šåˆ©é‡‘', type:'line', yAxisIndex:1, data:cData, itemStyle:{color:'#ef4444'}, smooth:true }
                ]
            });
            window.onresize = () => chart.resize();
        } else {
            document.getElementById('chart').innerHTML = '<div style="height:100%;display:flex;align-items:center;justify-content:center;color:#999">ç„¡æ­·å²æ•¸æ“š</div>';
        }
    }, 200);
}

function closeModal() { document.getElementById('detailModal').classList.remove('active'); }
</script>
</body>
</html>
